import{S as e,i as t,s,e as n,j as a,c as l,a as r,m as o,d as i,b as c,f as m,o as f,x as $,u,v as d,k as g,t as h,n as v,g as p,G as b,H as x,I as _,U as w,V as D,r as E,w as k,h as y,N as I,aI as j,aR as V,aS as T,aT as M,aU as C,l as O,E as N,O as P,aV as A,ax as R,J as S,a3 as U,aW as B,W as F,aX as G,K,ac as W,aK as X,T as z,F as H,P as J,Q as L,aY as Q,aZ as Y,as as Z,a_ as q,ad as ee,y as te,A as se,a$ as ne,D as ae,L as le,a0 as re,a1 as oe,$ as ie,b0 as ce}from"../../../chunks/vendor-d7518362.js";import{r as me,b as fe,d as $e,f as ue,m as de,t as ge,u as he,e as ve,_ as pe,c as be,h as xe,v as _e,l as we,n as De}from"../../../chunks/util-304b2847.js";import{t as Ee,M as ke,a as ye}from"../../../chunks/MenuItem-5cc5a14c.js";import{C as Ie,E as je,a as Ve}from"../../../chunks/events-5f4a58b6.js";import{R as Te}from"../../../chunks/Ripple-cf147083.js";import{a as Me,P as Ce,M as Oe,C as Ne}from"../../../chunks/compose-a6c6b8f1.js";import{M as Pe}from"../../../chunks/MoveTo-4a158c44.js";import{T as Ae}from"../../../chunks/TabTop-0fc6ba3e.js";import{D as Re}from"../../../chunks/Dialog-0470cc74.js";import{l as Se}from"../../../chunks/locale-0e600940.js";import"../../../chunks/singletons-12a22614.js";import"../../../chunks/preload-helper-ec9aa979.js";function Ue(e){let t,s;return t=new V({}),{c(){a(t.$$.fragment)},l(e){o(t.$$.fragment,e)},m(e,n){f(t,e,n),s=!0},i(e){s||($(t.$$.fragment,e),s=!0)},o(e){u(t.$$.fragment,e),s=!1},d(e){d(t,e)}}}function Be(e){let t,s;return t=new T({}),{c(){a(t.$$.fragment)},l(e){o(t.$$.fragment,e)},m(e,n){f(t,e,n),s=!0},i(e){s||($(t.$$.fragment,e),s=!0)},o(e){u(t.$$.fragment,e),s=!1},d(e){d(t,e)}}}function Fe(e){let t,s;return t=new M({}),{c(){a(t.$$.fragment)},l(e){o(t.$$.fragment,e)},m(e,n){f(t,e,n),s=!0},i(e){s||($(t.$$.fragment,e),s=!0)},o(e){u(t.$$.fragment,e),s=!1},d(e){d(t,e)}}}function Ge(e){let t,s;return t=new C({}),{c(){a(t.$$.fragment)},l(e){o(t.$$.fragment,e)},m(e,n){f(t,e,n),s=!0},i(e){s||($(t.$$.fragment,e),s=!0)},o(e){u(t.$$.fragment,e),s=!1},d(e){d(t,e)}}}function Ke(e){let t,s,g;return s=new j({}),{c(){t=n("div"),a(s.$$.fragment),this.h()},l(e){t=l(e,"DIV",{class:!0});var n=r(t);o(s.$$.fragment,n),n.forEach(i),this.h()},h(){c(t,"class","attachments svelte-f5vjeh")},m(e,n){m(e,t,n),f(s,t,null),g=!0},i(e){g||($(s.$$.fragment,e),g=!0)},o(e){u(s.$$.fragment,e),g=!1},d(e){e&&i(t),d(s)}}}function We(e){let t,s,j,V,T,M,C,O,N,P,A,R,S,U,B,F,G,K,W,X,z,H,J,L,Q,Y,Z,q,ee,te,se,ne,ae,le=Xe(e[1],e[0])+"",re=(e[0].subject||"")+"",oe=(e[0].intro||"")+"",ie=me(e[0].date)+"";const ce=[Be,Ue],fe=[];function $e(e,t){return e[2]?0:1}j=$e(e),V=fe[j]=ce[j](e),M=new Te({});const ue=[Ge,Fe],de=[];function ge(e,t){return e[0].flagged?0:1}N=ge(e),P=de[N]=ue[N](e),R=new Te({});let he=e[0].attachments&&Ke();return{c(){t=n("a"),s=n("div"),V.c(),T=g(),a(M.$$.fragment),C=g(),O=n("div"),P.c(),A=g(),a(R.$$.fragment),S=g(),U=n("div"),B=n("div"),F=h(le),G=g(),K=n("div"),W=n("div"),X=n("span"),z=h(re),H=g(),J=n("span"),L=h(oe),Q=g(),Y=n("div"),Z=n("div"),q=h(ie),ee=g(),he&&he.c(),this.h()},l(e){t=l(e,"A",{href:!0,class:!0});var n=r(t);s=l(n,"DIV",{class:!0});var a=r(s);V.l(a),T=v(a),o(M.$$.fragment,a),a.forEach(i),C=v(n),O=l(n,"DIV",{class:!0});var c=r(O);P.l(c),A=v(c),o(R.$$.fragment,c),c.forEach(i),S=v(n),U=l(n,"DIV",{class:!0});var m=r(U);B=l(m,"DIV",{class:!0});var f=r(B);F=p(f,le),f.forEach(i),G=v(m),K=l(m,"DIV",{class:!0});var $=r(K);W=l($,"DIV",{class:!0});var u=r(W);X=l(u,"SPAN",{class:!0});var d=r(X);z=p(d,re),d.forEach(i),H=v(u),J=l(u,"SPAN",{class:!0});var g=r(J);L=p(g,oe),g.forEach(i),u.forEach(i),Q=v($),Y=l($,"DIV",{class:!0});var h=r(Y);Z=l(h,"DIV",{class:!0});var b=r(Z);q=p(b,ie),b.forEach(i),ee=v(h),he&&he.l(h),h.forEach(i),$.forEach(i),m.forEach(i),n.forEach(i),this.h()},h(){c(s,"class","select cell-icon btn-dark svelte-f5vjeh"),c(O,"class","cell-icon btn-dark flag svelte-f5vjeh"),c(B,"class","from svelte-f5vjeh"),c(X,"class","subject svelte-f5vjeh"),c(J,"class","intro svelte-f5vjeh"),c(W,"class","subject-intro svelte-f5vjeh"),c(Z,"class","date svelte-f5vjeh"),c(Y,"class","date-attachments svelte-f5vjeh"),c(K,"class","end svelte-f5vjeh"),c(U,"class","flex svelte-f5vjeh"),c(t,"href",te="/mailbox/"+e[1].id+"/message/"+e[0].id),c(t,"class","na message svelte-f5vjeh"),b(t,"seen",e[0].seen),b(t,"selected",e[2]),b(t,"flagged",e[0].flagged)},m(n,a){m(n,t,a),x(t,s),fe[j].m(s,null),x(s,T),f(M,s,null),x(t,C),x(t,O),de[N].m(O,null),x(O,A),f(R,O,null),x(t,S),x(t,U),x(U,B),x(B,F),x(U,G),x(U,K),x(K,W),x(W,X),x(X,z),x(W,H),x(W,J),x(J,L),x(K,Q),x(K,Y),x(Y,Z),x(Z,q),x(Y,ee),he&&he.m(Y,null),se=!0,ne||(ae=[_(s,"click",w(D(e[3]))),_(O,"click",w(D(e[4]))),_(t,"click",e[5])],ne=!0)},p(e,[n]){let a=j;j=$e(e),j!==a&&(E(),u(fe[a],1,1,(()=>{fe[a]=null})),k(),V=fe[j],V||(V=fe[j]=ce[j](e),V.c()),$(V,1),V.m(s,T));let l=N;N=ge(e),N!==l&&(E(),u(de[l],1,1,(()=>{de[l]=null})),k(),P=de[N],P||(P=de[N]=ue[N](e),P.c()),$(P,1),P.m(O,A)),(!se||3&n)&&le!==(le=Xe(e[1],e[0])+"")&&y(F,le),(!se||1&n)&&re!==(re=(e[0].subject||"")+"")&&y(z,re),(!se||1&n)&&oe!==(oe=(e[0].intro||"")+"")&&y(L,oe),(!se||1&n)&&ie!==(ie=me(e[0].date)+"")&&y(q,ie),e[0].attachments?he?1&n&&$(he,1):(he=Ke(),he.c(),$(he,1),he.m(Y,null)):he&&(E(),u(he,1,1,(()=>{he=null})),k()),(!se||3&n&&te!==(te="/mailbox/"+e[1].id+"/message/"+e[0].id))&&c(t,"href",te),1&n&&b(t,"seen",e[0].seen),4&n&&b(t,"selected",e[2]),1&n&&b(t,"flagged",e[0].flagged)},i(e){se||($(V),$(M.$$.fragment,e),$(P),$(R.$$.fragment,e),$(he),se=!0)},o(e){u(V),u(M.$$.fragment,e),u(P),u(R.$$.fragment,e),u(he),se=!1},d(e){e&&i(t),fe[j].d(),d(M),de[N].d(),d(R),he&&he.d(),ne=!1,I(ae)}}}const Xe=(e,t)=>{var s,n;return"\\Drafts"===e.specialUse||"\\Sent"===e.specialUse?`To: ${(null===(s=t.to[0])||void 0===s?void 0:s.name)||(null===(n=t.to[0])||void 0===n?void 0:n.address)||""}`:t.from.name||t.from.address||""};function ze(e,t,s){let n;var a=this&&this.__awaiter||function(e,t,s,n){return new(s||(s=Promise))((function(a,l){function r(e){try{i(n.next(e))}catch(t){l(t)}}function o(e){try{i(n.throw(e))}catch(t){l(t)}}function i(e){var t;e.done?a(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(r,o)}i((n=n.apply(e,t||[])).next())}))};let{mailbox:l}=t,{message:r}=t,{selection:o}=t;const i=fe((()=>a(void 0,void 0,void 0,(function*(){s(0,r.flagged=!r.flagged,r),yield $e(`/api/mailboxes/${l.id}/messages/${r.id}/flag`,{value:r.flagged}).catch((e=>{throw s(0,r.flagged=!r.flagged,r),e}))})))),c=fe((e=>a(void 0,void 0,void 0,(function*(){ue(l)&&(e.preventDefault(),e.stopPropagation(),yield Me(l,r.id))}))));return e.$$set=e=>{"mailbox"in e&&s(1,l=e.mailbox),"message"in e&&s(0,r=e.message),"selection"in e&&s(6,o=e.selection)},e.$$.update=()=>{65&e.$$.dirty&&s(2,n=o.some((e=>e.id===r.id)))},[r,l,n,()=>{const e=o.filter((e=>e.id!==r.id));s(6,o=n?e:[...e,r])},i,c,o]}class He extends e{constructor(e){super(),t(this,e,ze,We,s,{mailbox:1,message:0,selection:6})}}function Je(e){let t,s;return t=new B({}),{c(){a(t.$$.fragment)},l(e){o(t.$$.fragment,e)},m(e,n){f(t,e,n),s=!0},i(e){s||($(t.$$.fragment,e),s=!0)},o(e){u(t.$$.fragment,e),s=!1},d(e){d(t,e)}}}function Le(e){let t,s;return t=new T({}),{c(){a(t.$$.fragment)},l(e){o(t.$$.fragment,e)},m(e,n){f(t,e,n),s=!0},i(e){s||($(t.$$.fragment,e),s=!0)},o(e){u(t.$$.fragment,e),s=!1},d(e){d(t,e)}}}function Qe(e){let t,s;return t=new V({}),{c(){a(t.$$.fragment)},l(e){o(t.$$.fragment,e)},m(e,n){f(t,e,n),s=!0},i(e){s||($(t.$$.fragment,e),s=!0)},o(e){u(t.$$.fragment,e),s=!1},d(e){d(t,e)}}}function Ye(e){let t,s,b,w,D,j,V,T,M,C,O,N,P,A,R,B,z,H,J,L,Q,Y,Z,q,ee,te,se,ne,ae,le,re=e[1].length+"";const oe=[et,qe],ie=[];function ce(e,t){return(null==b||2&t)&&(b=!e[1].every(dt)),b?0:1}w=ce(e,-1),D=ie[w]=oe[w](e);const me=[st,tt],fe=[];function $e(e,t){return(null==V||4&t)&&(V=!!ge(e[2])),V?0:((null==T||4&t)&&(T=!(ue(e[2])||_e(e[2])||ve(e[2]))),T?1:-1)}function de(e,t){return 1===e[1].length?at:nt}~(M=$e(e,-1))&&(C=fe[M]=me[M](e)),P=new F({}),R=new Te({}),J=new Pe({props:{mailbox:e[2],onMove:e[15]}}),Y=new G({});let he=de(e),pe=he(e);return{c(){t=n("div"),s=n("div"),D.c(),j=g(),C&&C.c(),O=g(),N=n("div"),a(P.$$.fragment),A=g(),a(R.$$.fragment),z=g(),H=n("div"),a(J.$$.fragment),L=g(),Q=n("div"),a(Y.$$.fragment),Z=g(),q=n("span"),ee=h(re),te=g(),pe.c(),this.h()},l(e){t=l(e,"DIV",{class:!0});var n=r(t);s=l(n,"DIV",{class:!0});var a=r(s);D.l(a),j=v(a),C&&C.l(a),O=v(a),N=l(a,"DIV",{class:!0});var c=r(N);o(P.$$.fragment,c),A=v(c),o(R.$$.fragment,c),c.forEach(i),a.forEach(i),z=v(n),H=l(n,"DIV",{class:!0});var m=r(H);o(J.$$.fragment,m),m.forEach(i),L=v(n),Q=l(n,"DIV",{class:!0});var f=r(Q);o(Y.$$.fragment,f),Z=v(f),q=l(f,"SPAN",{class:!0});var $=r(q);ee=p($,re),te=v($),pe.l($),$.forEach(i),f.forEach(i),n.forEach(i),this.h()},h(){c(N,"class","action btn-dark"),c(s,"class","action-group"),c(H,"class","action-group"),c(q,"class","svelte-11o3ds4"),c(Q,"class","selection-info svelte-11o3ds4"),c(t,"class","only-when-selection svelte-11o3ds4")},m(n,a){m(n,t,a),x(t,s),ie[w].m(s,null),x(s,j),~M&&fe[M].m(s,null),x(s,O),x(s,N),f(P,N,null),x(N,A),f(R,N,null),x(t,z),x(t,H),f(J,H,null),x(t,L),x(t,Q),f(Y,Q,null),x(Q,Z),x(Q,q),x(q,ee),x(q,te),pe.m(q,null),ne=!0,ae||(le=[S(B=Ee.call(null,N,ve(e[2])?e[7].Delete_permanently:ue(e[2])?e[7].Discard_drafts:e[7].Delete)),_(N,"click",e[12])],ae=!0)},p(e,t){let n=w;w=ce(e,t),w===n?ie[w].p(e,t):(E(),u(ie[n],1,1,(()=>{ie[n]=null})),k(),D=ie[w],D?D.p(e,t):(D=ie[w]=oe[w](e),D.c()),$(D,1),D.m(s,j));let a=M;M=$e(e,t),M===a?~M&&fe[M].p(e,t):(C&&(E(),u(fe[a],1,1,(()=>{fe[a]=null})),k()),~M?(C=fe[M],C?C.p(e,t):(C=fe[M]=me[M](e),C.c()),$(C,1),C.m(s,O)):C=null),B&&U(B.update)&&132&t&&B.update.call(null,ve(e[2])?e[7].Delete_permanently:ue(e[2])?e[7].Discard_drafts:e[7].Delete);const l={};4&t&&(l.mailbox=e[2]),J.$set(l),(!ne||2&t)&&re!==(re=e[1].length+"")&&y(ee,re),he===(he=de(e))&&pe?pe.p(e,t):(pe.d(1),pe=he(e),pe&&(pe.c(),pe.m(q,null)))},i(e){ne||($(D),$(C),$(P.$$.fragment,e),$(R.$$.fragment,e),$(J.$$.fragment,e),$(Y.$$.fragment,e),e&&(se||K((()=>{se=W(t,X,{duration:200}),se.start()}))),ne=!0)},o(e){u(D),u(C),u(P.$$.fragment,e),u(R.$$.fragment,e),u(J.$$.fragment,e),u(Y.$$.fragment,e),ne=!1},d(e){e&&i(t),ie[w].d(),~M&&fe[M].d(),d(P),d(R),d(J),d(Y),pe.d(),ae=!1,I(le)}}}function Ze(e){let t,s,h,p,w,D,E,k,y,I,j,V,T,M,C,O;function N(t){e[19](t)}p=new z({}),D=new Te({});let P={anchor:"top-left",$$slots:{default:[ot]},$$scope:{ctx:e}};function A(e,t){return 1===e[2].total?ct:it}void 0!==e[4]&&(P.open=e[4]),y=new Ce({props:P}),H.push((()=>J(y,"open",N)));let R=A(e),S=R(e);return{c(){t=n("div"),s=n("div"),h=n("div"),a(p.$$.fragment),w=g(),a(D.$$.fragment),E=g(),k=n("div"),a(y.$$.fragment),V=g(),T=n("div"),S.c(),this.h()},l(e){t=l(e,"DIV",{class:!0});var n=r(t);s=l(n,"DIV",{class:!0});var a=r(s);h=l(a,"DIV",{class:!0});var c=r(h);o(p.$$.fragment,c),w=v(c),o(D.$$.fragment,c),c.forEach(i),E=v(a),k=l(a,"DIV",{class:!0});var m=r(k);o(y.$$.fragment,m),m.forEach(i),a.forEach(i),n.forEach(i),V=v(e),T=l(e,"DIV",{class:!0});var f=r(T);S.l(f),f.forEach(i),this.h()},h(){c(h,"class","action btn-dark"),b(h,"hover",e[4]),c(k,"class","clear-anchor svelte-11o3ds4"),c(s,"class","clear-btn-wrap svelte-11o3ds4"),c(t,"class","action-group"),c(T,"class","total svelte-11o3ds4")},m(n,a){m(n,t,a),x(t,s),x(s,h),f(p,h,null),x(h,w),f(D,h,null),x(s,E),x(s,k),f(y,k,null),m(n,V,a),m(n,T,a),S.m(T,null),M=!0,C||(O=_(h,"click",e[17]),C=!0)},p(e,t){16&t&&b(h,"hover",e[4]);const s={};268435616&t&&(s.$$scope={dirty:t,ctx:e}),!I&&16&t&&(I=!0,s.open=e[4],L((()=>I=!1))),y.$set(s),R===(R=A(e))&&S?S.p(e,t):(S.d(1),S=R(e),S&&(S.c(),S.m(T,null)))},i(e){M||($(p.$$.fragment,e),$(D.$$.fragment,e),$(y.$$.fragment,e),e&&(j||K((()=>{j=W(t,X,{duration:200}),j.start()}))),M=!0)},o(e){u(p.$$.fragment,e),u(D.$$.fragment,e),u(y.$$.fragment,e),M=!1},d(e){e&&i(t),d(p),d(D),d(y),e&&i(V),e&&i(T),S.d(),C=!1,O()}}}function qe(e){let t,s,h,p,b,w,D,E;return s=new Q({}),p=new Te({}),{c(){t=n("div"),a(s.$$.fragment),h=g(),a(p.$$.fragment),this.h()},l(e){t=l(e,"DIV",{class:!0});var n=r(t);o(s.$$.fragment,n),h=v(n),o(p.$$.fragment,n),n.forEach(i),this.h()},h(){c(t,"class","action btn-dark")},m(n,a){m(n,t,a),f(s,t,null),x(t,h),f(p,t,null),w=!0,D||(E=[S(b=Ee.call(null,t,e[7].Mark_as_not_seen)),_(t,"click",e[21])],D=!0)},p(e,t){b&&U(b.update)&&128&t&&b.update.call(null,e[7].Mark_as_not_seen)},i(e){w||($(s.$$.fragment,e),$(p.$$.fragment,e),w=!0)},o(e){u(s.$$.fragment,e),u(p.$$.fragment,e),w=!1},d(e){e&&i(t),d(s),d(p),D=!1,I(E)}}}function et(e){let t,s,h,p,b,w,D,E;return s=new Y({}),p=new Te({}),{c(){t=n("div"),a(s.$$.fragment),h=g(),a(p.$$.fragment),this.h()},l(e){t=l(e,"DIV",{class:!0});var n=r(t);o(s.$$.fragment,n),h=v(n),o(p.$$.fragment,n),n.forEach(i),this.h()},h(){c(t,"class","action btn-dark")},m(n,a){m(n,t,a),f(s,t,null),x(t,h),f(p,t,null),w=!0,D||(E=[S(b=Ee.call(null,t,e[7].Mark_as_seen)),_(t,"click",e[20])],D=!0)},p(e,t){b&&U(b.update)&&128&t&&b.update.call(null,e[7].Mark_as_seen)},i(e){w||($(s.$$.fragment,e),$(p.$$.fragment,e),w=!0)},o(e){u(s.$$.fragment,e),u(p.$$.fragment,e),w=!1},d(e){e&&i(t),d(s),d(p),D=!1,I(E)}}}function tt(e){let t,s,h,p,b,w,D,E;return s=new Z({}),p=new Te({}),{c(){t=n("div"),a(s.$$.fragment),h=g(),a(p.$$.fragment),this.h()},l(e){t=l(e,"DIV",{class:!0});var n=r(t);o(s.$$.fragment,n),h=v(n),o(p.$$.fragment,n),n.forEach(i),this.h()},h(){c(t,"class","action btn-dark")},m(n,a){m(n,t,a),f(s,t,null),x(t,h),f(p,t,null),w=!0,D||(E=[S(b=Ee.call(null,t,e[7].Mark_as_spam)),_(t,"click",e[11])],D=!0)},p(e,t){b&&U(b.update)&&128&t&&b.update.call(null,e[7].Mark_as_spam)},i(e){w||($(s.$$.fragment,e),$(p.$$.fragment,e),w=!0)},o(e){u(s.$$.fragment,e),u(p.$$.fragment,e),w=!1},d(e){e&&i(t),d(s),d(p),D=!1,I(E)}}}function st(e){let t,s,h,p,b,w,D,E;return s=new q({}),p=new Te({}),{c(){t=n("div"),a(s.$$.fragment),h=g(),a(p.$$.fragment),this.h()},l(e){t=l(e,"DIV",{class:!0});var n=r(t);o(s.$$.fragment,n),h=v(n),o(p.$$.fragment,n),n.forEach(i),this.h()},h(){c(t,"class","action btn-dark")},m(n,a){m(n,t,a),f(s,t,null),x(t,h),f(p,t,null),w=!0,D||(E=[S(b=Ee.call(null,t,e[7].This_is_not_spam)),_(t,"click",e[11])],D=!0)},p(e,t){b&&U(b.update)&&128&t&&b.update.call(null,e[7].This_is_not_spam)},i(e){w||($(s.$$.fragment,e),$(p.$$.fragment,e),w=!0)},o(e){u(s.$$.fragment,e),u(p.$$.fragment,e),w=!1},d(e){e&&i(t),d(s),d(p),D=!1,I(E)}}}function nt(e){let t,s=e[7].messages+"";return{c(){t=h(s)},l(e){t=p(e,s)},m(e,s){m(e,t,s)},p(e,n){128&n&&s!==(s=e[7].messages+"")&&y(t,s)},d(e){e&&i(t)}}}function at(e){let t,s=e[7].message+"";return{c(){t=h(s)},l(e){t=p(e,s)},m(e,s){m(e,t,s)},p(e,n){128&n&&s!==(s=e[7].message+"")&&y(t,s)},d(e){e&&i(t)}}}function lt(e){let t,s=e[7].Delete_all_messages+"";return{c(){t=h(s)},l(e){t=p(e,s)},m(e,s){m(e,t,s)},p(e,n){128&n&&s!==(s=e[7].Delete_all_messages+"")&&y(t,s)},d(e){e&&i(t)}}}function rt(e){let t,s;return t=new ke({props:{icon:F,$$slots:{default:[lt]},$$scope:{ctx:e}}}),t.$on("click",e[18]),{c(){a(t.$$.fragment)},l(e){o(t.$$.fragment,e)},m(e,n){f(t,e,n),s=!0},p(e,s){const n={};268435584&s&&(n.$$scope={dirty:s,ctx:e}),t.$set(n)},i(e){s||($(t.$$.fragment,e),s=!0)},o(e){u(t.$$.fragment,e),s=!1},d(e){d(t,e)}}}function ot(e){let t,s;return t=new Oe({props:{$$slots:{default:[rt]},$$scope:{ctx:e}}}),{c(){a(t.$$.fragment)},l(e){o(t.$$.fragment,e)},m(e,n){f(t,e,n),s=!0},p(e,s){const n={};268435616&s&&(n.$$scope={dirty:s,ctx:e}),t.$set(n)},i(e){s||($(t.$$.fragment,e),s=!0)},o(e){u(t.$$.fragment,e),s=!1},d(e){d(t,e)}}}function it(e){let t,s,n,a=e[2].total+"",l=e[7].messages+"";return{c(){t=h(a),s=g(),n=h(l)},l(e){t=p(e,a),s=v(e),n=p(e,l)},m(e,a){m(e,t,a),m(e,s,a),m(e,n,a)},p(e,s){4&s&&a!==(a=e[2].total+"")&&y(t,a),128&s&&l!==(l=e[7].messages+"")&&y(n,l)},d(e){e&&i(t),e&&i(s),e&&i(n)}}}function ct(e){let t,s,n=e[7].message+"";return{c(){t=h("1 "),s=h(n)},l(e){t=p(e,"1 "),s=p(e,n)},m(e,n){m(e,t,n),m(e,s,n)},p(e,t){128&t&&n!==(n=e[7].message+"")&&y(s,n)},d(e){e&&i(t),e&&i(s)}}}function mt(e){let t,s,h,p,b,w,D,y,j,V,T,M,C,N,P,B,F,G,K,W;const X=[Qe,Le,Je],z=[];function H(e,t){return 0===e[1].length?0:e[1].length===e[0].results.length?1:2}h=H(e),p=z[h]=X[h](e),w=new Te({}),V=new A({}),M=new Te({});const J=[Ze,Ye],L=[];function Q(e,t){return 0===e[1].length&&0!==e[0].results.length?0:0!==e[1].length?1:-1}return~(P=Q(e))&&(B=L[P]=J[P](e)),{c(){t=n("div"),s=n("div"),p.c(),b=g(),a(w.$$.fragment),D=g(),y=n("div"),j=n("div"),a(V.$$.fragment),T=g(),a(M.$$.fragment),N=g(),B&&B.c(),F=O(),this.h()},l(e){t=l(e,"DIV",{class:!0});var n=r(t);s=l(n,"DIV",{class:!0});var a=r(s);p.l(a),b=v(a),o(w.$$.fragment,a),a.forEach(i),D=v(n),y=l(n,"DIV",{class:!0});var c=r(y);j=l(c,"DIV",{class:!0,style:!0});var m=r(j);o(V.$$.fragment,m),m.forEach(i),T=v(c),o(M.$$.fragment,c),c.forEach(i),n.forEach(i),N=v(e),B&&B.l(e),F=O(),this.h()},h(){c(s,"class","action btn-dark"),c(j,"class","reload-inner svelte-11o3ds4"),R(j,"transform","rotate("+360*e[6]+"deg)"),c(y,"class","action btn-dark reload"),c(t,"class","action-group select svelte-11o3ds4")},m(n,a){m(n,t,a),x(t,s),z[h].m(s,null),x(s,b),f(w,s,null),x(t,D),x(t,y),x(y,j),f(V,j,null),x(y,T),f(M,y,null),m(n,N,a),~P&&L[P].m(n,a),m(n,F,a),G=!0,K||(W=[_(s,"click",e[14]),S(C=Ee.call(null,y,e[7].Reload)),_(y,"click",e[9])],K=!0)},p(e,t){let n=h;h=H(e),h!==n&&(E(),u(z[n],1,1,(()=>{z[n]=null})),k(),p=z[h],p||(p=z[h]=X[h](e),p.c()),$(p,1),p.m(s,b)),(!G||64&t)&&R(j,"transform","rotate("+360*e[6]+"deg)"),C&&U(C.update)&&128&t&&C.update.call(null,e[7].Reload);let a=P;P=Q(e),P===a?~P&&L[P].p(e,t):(B&&(E(),u(L[a],1,1,(()=>{L[a]=null})),k()),~P?(B=L[P],B?B.p(e,t):(B=L[P]=J[P](e),B.c()),$(B,1),B.m(F.parentNode,F)):B=null)},i(e){G||($(p),$(w.$$.fragment,e),$(V.$$.fragment,e),$(M.$$.fragment,e),$(B),G=!0)},o(e){u(p),u(w.$$.fragment,e),u(V.$$.fragment,e),u(M.$$.fragment,e),u(B),G=!1},d(e){e&&i(t),z[h].d(),d(w),d(V),d(M),e&&i(N),~P&&L[P].d(e),e&&i(F),K=!1,I(W)}}}function ft(e){let t,s;return t=new Re({props:{title:e[7].Delete_all_messages+" "+e[7].of+" "+de(e[2]),width:"550px",onClose:e[22],$$slots:{default:[$t]},$$scope:{ctx:e}}}),{c(){a(t.$$.fragment)},l(e){o(t.$$.fragment,e)},m(e,n){f(t,e,n),s=!0},p(e,s){const n={};132&s&&(n.title=e[7].Delete_all_messages+" "+e[7].of+" "+de(e[2])),32&s&&(n.onClose=e[22]),268435584&s&&(n.$$scope={dirty:s,ctx:e}),t.$set(n)},i(e){s||($(t.$$.fragment,e),s=!0)},o(e){u(t.$$.fragment,e),s=!1},d(e){d(t,e)}}}function $t(e){let t,s,a,o,f,$,u,d,b=e[7].This_action_will_delete_all_messages_in_the_folder+"",w=e[7].Delete_all_messages+"";return{c(){t=n("div"),s=n("div"),a=h(b),o=g(),f=n("button"),$=h(w),this.h()},l(e){t=l(e,"DIV",{class:!0});var n=r(t);s=l(n,"DIV",{class:!0});var c=r(s);a=p(c,b),c.forEach(i),o=v(n),f=l(n,"BUTTON",{class:!0});var m=r(f);$=p(m,w),m.forEach(i),n.forEach(i),this.h()},h(){c(s,"class","clear-label svelte-11o3ds4"),c(f,"class","clear-confirm btn-light btn-primary elev2 svelte-11o3ds4"),c(t,"class","clear-body svelte-11o3ds4")},m(n,l){m(n,t,l),x(t,s),x(s,a),x(t,o),x(t,f),x(f,$),u||(d=_(f,"click",e[13]),u=!0)},p(e,t){128&t&&b!==(b=e[7].This_action_will_delete_all_messages_in_the_folder+"")&&y(a,b),128&t&&w!==(w=e[7].Delete_all_messages+"")&&y($,w)},d(e){e&&i(t),u=!1,d()}}}function ut(e){let t,s,n,l;t=new Ae({props:{scrolled:e[3],$$slots:{default:[mt]},$$scope:{ctx:e}}});let r=e[5]&&ft(e);return{c(){a(t.$$.fragment),s=g(),r&&r.c(),n=O()},l(e){o(t.$$.fragment,e),s=v(e),r&&r.l(e),n=O()},m(e,a){f(t,e,a),m(e,s,a),r&&r.m(e,a),m(e,n,a),l=!0},p(e,[s]){const a={};8&s&&(a.scrolled=e[3]),268435703&s&&(a.$$scope={dirty:s,ctx:e}),t.$set(a),e[5]?r?(r.p(e,s),32&s&&$(r,1)):(r=ft(e),r.c(),$(r,1),r.m(n.parentNode,n)):r&&(E(),u(r,1,1,(()=>{r=null})),k())},i(e){l||($(t.$$.fragment,e),$(r),l=!0)},o(e){u(t.$$.fragment,e),u(r),l=!1},d(e){d(t,e),e&&i(s),r&&r.d(e),e&&i(n)}}}const dt=e=>e.seen;function gt(e,t,s){let n,a;N(e,Se,(e=>s(7,n=e)));var l=this&&this.__awaiter||function(e,t,s,n){return new(s||(s=Promise))((function(a,l){function r(e){try{i(n.next(e))}catch(t){l(t)}}function o(e){try{i(n.throw(e))}catch(t){l(t)}}function i(e){var t;e.done?a(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(r,o)}i((n=n.apply(e,t||[])).next())}))};let{mailbox:r}=t,{messages:o}=t,{selection:i}=t,{scrolled:c=!1}=t,{loadingMore:m}=t,f=!1,$=!1;const{mailboxes:u}=P("dash");N(e,u,(e=>s(23,a=e)));const{prev:d,next:g}=P("mailbox");let h=0;const v=fe((e=>l(void 0,void 0,void 0,(function*(){const t=i.map((e=>e.id));yield $e(`/api/mailboxes/${r.id}/messages`,{message:t.join(","),seen:e});for(const s of i)s.seen=e;s(0,o=Object.assign({},o)),s(1,i=[...i])})))),p=fe((()=>l(void 0,void 0,void 0,(function*(){if(ge(r)){const e=a.find(he);yield w(e)}else{const e=a.find(ge);yield w(e)}})))),b=fe((()=>l(void 0,void 0,void 0,(function*(){if(ve(r)||ge(r))yield Promise.all(i.map((e=>l(void 0,void 0,void 0,(function*(){yield pe(`/api/mailboxes/${r.id}/messages/${e.id}`)}))))),_();else{const e=a.find(ve);w(e)}})))),x=fe((()=>l(void 0,void 0,void 0,(function*(){if(ve(r)||ue(r))pe(`/api/mailboxes/${r.id}/messages`).then((()=>{be(n.notifier.All_messages_deleted)})).catch((e=>{xe(null==e?void 0:e.message)}));else{const e=a.find(ve);$e(`/api/mailboxes/${r.id}/messages`,{message:`1:${Number.MAX_SAFE_INTEGER}`,moveTo:e.id}).then((()=>{be("All messages deleted")})).catch((e=>{xe(null==e?void 0:e.message)}))}s(5,$=!1),r.total>50&&be(n.notifier.Deleting_process)})))),_=()=>{const e=i.map((e=>e.id));s(0,o=Object.assign(Object.assign({},o),{results:o.results.filter((t=>!e.includes(t.id)))})),o.results.length<15&&o.nextCursor&&(s(16,m=!0),setTimeout(g,10)),s(1,i=[])},w=fe((e=>l(void 0,void 0,void 0,(function*(){r.id!==e.id&&0!==i.length&&(yield $e(`/api/mailboxes/${r.id}/messages`,{message:i.map((e=>e.id)).join(","),moveTo:e.id}),_())}))));return e.$$set=e=>{"mailbox"in e&&s(2,r=e.mailbox),"messages"in e&&s(0,o=e.messages),"selection"in e&&s(1,i=e.selection),"scrolled"in e&&s(3,c=e.scrolled),"loadingMore"in e&&s(16,m=e.loadingMore)},[o,i,r,c,f,$,h,n,u,()=>{s(6,h++,h),d()},v,p,b,x,()=>{i.length===o.results.length?s(1,i=[]):s(1,i=o.results.slice())},w,m,()=>s(4,f=!0),()=>s(5,$=!0),function(e){f=e,s(4,f)},()=>v(!0),()=>v(!1),()=>s(5,$=!1)]}class ht extends e{constructor(e){super(),t(this,e,gt,ut,s,{mailbox:2,messages:0,selection:1,scrolled:3,loadingMore:16})}}function vt(e,t,s){const n=e.slice();return n[18]=t[s],n[19]=t,n[20]=s,n}function pt(e){let t,s,a,o,f=e[5].This_mailbox_is_empty+"";return{c(){t=n("div"),s=n("div"),a=h(f),this.h()},l(e){t=l(e,"DIV",{class:!0});var n=r(t);s=l(n,"DIV",{class:!0});var o=r(s);a=p(o,f),o.forEach(i),n.forEach(i),this.h()},h(){c(s,"class","empty svelte-mhthi6"),c(t,"class","empty-wrap")},m(e,n){m(e,t,n),x(t,s),x(s,a)},p(e,t){32&t&&f!==(f=e[5].This_mailbox_is_empty+"")&&y(a,f)},i(s){s&&(o||K((()=>{o=W(t,e[8],{duration:250}),o.start()})))},o:ae,d(e){e&&i(t)}}}function bt(e){let t,s,a,o,f,d,h,p=[],b=new Map,x=e[1].results;const _=e=>e[18].id;for(let n=0;n<x.length;n+=1){let t=vt(e,x,n),s=_(t);b.set(s,p[n]=xt(s,t))}const w=[wt,_t],D=[];function y(e,t){return e[4]?0:e[1].nextCursor?1:-1}return~(f=y(e))&&(d=D[f]=w[f](e)),{c(){t=n("div");for(let e=0;e<p.length;e+=1)p[e].c();a=g(),o=n("div"),d&&d.c(),this.h()},l(e){t=l(e,"DIV",{class:!0});var s=r(t);for(let t=0;t<p.length;t+=1)p[t].l(s);s.forEach(i),a=v(e),o=l(e,"DIV",{class:!0});var n=r(o);d&&d.l(n),n.forEach(i),this.h()},h(){c(t,"class","messages"),c(o,"class","next-wrap svelte-mhthi6")},m(e,s){m(e,t,s);for(let n=0;n<p.length;n+=1)p[n].m(t,null);m(e,a,s),m(e,o,s),~f&&D[f].m(o,null),h=!0},p(e,s){7&s&&(x=e[1].results,E(),p=re(p,s,_,1,e,x,b,t,oe,xt,null,vt),k());let n=f;f=y(e),f===n?~f&&D[f].p(e,s):(d&&(E(),u(D[n],1,1,(()=>{D[n]=null})),k()),~f?(d=D[f],d?d.p(e,s):(d=D[f]=w[f](e),d.c()),$(d,1),d.m(o,null)):d=null)},i(n){if(!h){for(let e=0;e<x.length;e+=1)$(p[e]);n&&K((()=>{s||(s=le(t,e[8],{duration:250},!0)),s.run(1)})),$(d),h=!0}},o(n){for(let e=0;e<p.length;e+=1)u(p[e]);n&&(s||(s=le(t,e[8],{duration:250},!1)),s.run(0)),u(d),h=!1},d(e){e&&i(t);for(let t=0;t<p.length;t+=1)p[t].d();e&&s&&s.end(),e&&i(a),e&&i(o),~f&&D[f].d()}}}function xt(e,t){let s,h,p,b,_,w,D;function E(e){t[12](e,t[18],t[19],t[20])}function k(e){t[13](e)}let y={mailbox:t[0]};return void 0!==t[18]&&(y.message=t[18]),void 0!==t[2]&&(y.selection=t[2]),h=new He({props:y}),H.push((()=>J(h,"message",E))),H.push((()=>J(h,"selection",k))),{key:e,first:null,c(){s=n("div"),a(h.$$.fragment),_=g(),this.h()},l(e){s=l(e,"DIV",{class:!0});var t=r(s);o(h.$$.fragment,t),_=v(t),t.forEach(i),this.h()},h(){c(s,"class","message"),this.first=s},m(e,t){m(e,s,t),f(h,s,null),x(s,_),D=!0},p(e,s){t=e;const n={};1&s&&(n.mailbox=t[0]),!p&&2&s&&(p=!0,n.message=t[18],L((()=>p=!1))),!b&&4&s&&(b=!0,n.selection=t[2],L((()=>b=!1))),h.$set(n)},i(e){D||($(h.$$.fragment,e),e&&K((()=>{w||(w=le(s,t[8],{duration:250},!0)),w.run(1)})),D=!0)},o(e){u(h.$$.fragment,e),e&&(w||(w=le(s,t[8],{duration:250},!1)),w.run(0)),D=!1},d(e){e&&i(s),d(h),e&&w&&w.end()}}}function _t(e){let t,s,h,p,b,w,D;return s=new ie({}),p=new Te({}),{c(){t=n("div"),a(s.$$.fragment),h=g(),a(p.$$.fragment),this.h()},l(e){t=l(e,"DIV",{class:!0});var n=r(t);o(s.$$.fragment,n),h=v(n),o(p.$$.fragment,n),n.forEach(i),this.h()},h(){c(t,"class","next btn-dark svelte-mhthi6")},m(n,a){m(n,t,a),f(s,t,null),x(t,h),f(p,t,null),b=!0,w||(D=_(t,"click",e[6]),w=!0)},p:ae,i(e){b||($(s.$$.fragment,e),$(p.$$.fragment,e),b=!0)},o(e){u(s.$$.fragment,e),u(p.$$.fragment,e),b=!1},d(e){e&&i(t),d(s),d(p),w=!1,D()}}}function wt(e){let t,s,g;return s=new Ne({}),{c(){t=n("div"),a(s.$$.fragment),this.h()},l(e){t=l(e,"DIV",{class:!0});var n=r(t);o(s.$$.fragment,n),n.forEach(i),this.h()},h(){c(t,"class","loading-more svelte-mhthi6")},m(e,n){m(e,t,n),f(s,t,null),g=!0},p:ae,i(e){g||($(s.$$.fragment,e),g=!0)},o(e){u(s.$$.fragment,e),g=!1},d(e){e&&i(t),d(s)}}}function Dt(e){let t,s,h,p,b,_,w,D,y,I,j,V,T;function M(t){e[9](t)}function C(t){e[10](t)}function O(t){e[11](t)}let N={mailbox:e[0],scrolled:e[3]};void 0!==e[1]&&(N.messages=e[1]),void 0!==e[2]&&(N.selection=e[2]),void 0!==e[4]&&(N.loadingMore=e[4]),s=new ht({props:N}),H.push((()=>J(s,"messages",M))),H.push((()=>J(s,"selection",C))),H.push((()=>J(s,"loadingMore",O)));const P=[bt,pt],A=[];function R(e,t){return e[1].results.length||e[4]?0:1}return D=R(e),y=A[D]=P[D](e),{c(){t=n("div"),a(s.$$.fragment),_=g(),w=n("div"),y.c(),this.h()},l(e){t=l(e,"DIV",{class:!0});var n=r(t);o(s.$$.fragment,n),_=v(n),w=l(n,"DIV",{class:!0});var a=r(w);y.l(a),a.forEach(i),n.forEach(i),this.h()},h(){c(w,"class","content svelte-mhthi6"),c(t,"class","mailbox svelte-mhthi6")},m(n,a){m(n,t,a),f(s,t,null),x(t,_),x(t,w),A[D].m(w,null),j=!0,V||(T=S(e[7].call(null,w)),V=!0)},p(e,[t]){const n={};1&t&&(n.mailbox=e[0]),8&t&&(n.scrolled=e[3]),!h&&2&t&&(h=!0,n.messages=e[1],L((()=>h=!1))),!p&&4&t&&(p=!0,n.selection=e[2],L((()=>p=!1))),!b&&16&t&&(b=!0,n.loadingMore=e[4],L((()=>b=!1))),s.$set(n);let a=D;D=R(e),D===a?A[D].p(e,t):(E(),u(A[a],1,1,(()=>{A[a]=null})),k(),y=A[D],y?y.p(e,t):(y=A[D]=P[D](e),y.c()),$(y,1),y.m(w,null))},i(e){j||($(s.$$.fragment,e),$(y),I||K((()=>{I=W(w,ee,{duration:150,y:-15}),I.start()})),j=!0)},o(e){u(s.$$.fragment,e),u(y),j=!1},d(e){e&&i(t),d(s),A[D].d(),V=!1,T()}}}function Et(e,t,s){let n;N(e,Se,(e=>s(5,n=e)));var a=this&&this.__awaiter||function(e,t,s,n){return new(s||(s=Promise))((function(a,l){function r(e){try{i(n.next(e))}catch(t){l(t)}}function o(e){try{i(n.throw(e))}catch(t){l(t)}}function i(e){var t;e.done?a(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(r,o)}i((n=n.apply(e,t||[])).next())}))};let{mailbox:l}=t,{messages:r}=t,{selection:o=[]}=t,i=!1,c=!1;const m=fe((()=>a(void 0,void 0,void 0,(function*(){if(r.nextCursor){s(4,c=!0);try{const e=yield we(`/api/mailboxes/${l.id}/messages?next=${r.nextCursor}&limit=50`);s(1,r=Object.assign(Object.assign({},r),{results:$([...r.results,...e.results]),nextCursor:e.nextCursor})),s(4,c=!1)}catch(e){throw s(4,c=!1),e}}})))),f=fe((()=>a(void 0,void 0,void 0,(function*(){const e=yield we(`/api/mailboxes/${l.id}/messages`);s(1,r=Object.assign(Object.assign({},r),{results:$([...e.results,...r.results])}))}))));te("mailbox",{next:m,prev:f});se((()=>Ie.on((e=>{e.mailbox===l.id&&(s(0,l.unseen=e.unseen,l),s(0,l.total=e.total,l))}))));const $=e=>{const t=[];for(const s of e)t.every((e=>e.id!==s.id))&&t.push(s);return t};se((()=>{let e,t,n,a=[];const i=()=>{r.results.some((e=>a.includes(e.id)))&&(s(1,r=Object.assign(Object.assign({},r),{results:r.results.filter((e=>!a.includes(e.id)))})),s(2,o=o.filter((e=>!a.includes(e.id))))),r.results.length<15&&(clearTimeout(n),n=setTimeout(m,500)),a=[]},c=[je.on((t=>{t.mailbox===l.id&&(clearTimeout(e),e=setTimeout(f,500))})),Ve.on((e=>{e.mailbox===l.id&&null!=e.uid&&(a.push(e.uid),clearTimeout(t),t=setTimeout(i,250))}))];return()=>{clearTimeout(e),clearTimeout(t),clearTimeout(n),I(c)}}));return e.$$set=e=>{"mailbox"in e&&s(0,l=e.mailbox),"messages"in e&&s(1,r=e.messages),"selection"in e&&s(2,o=e.selection)},[l,r,o,i,c,n,m,e=>({destroy:ye(e,"scroll",(()=>{s(3,i=0!==e.scrollTop)}),{passive:!0})}),(e,{delay:t=0,duration:s=400,easing:n=ne}={})=>{const a=e.getBoundingClientRect().height;return{delay:t,duration:s,easing:n,css:(e,t)=>`box-sizing: border-boxoverflow: hidden;opacity: ${e};height: ${e*a}px;`}},function(e){r=e,s(1,r)},function(e){o=e,s(2,o)},function(e){c=e,s(4,c)},function(e,t,n,a){n[a]=e,s(1,r)},function(e){o=e,s(2,o)}]}class kt extends e{constructor(e){super(),t(this,e,Et,Dt,s,{mailbox:0,messages:1,selection:2})}}function yt(e){let t,s,n,l;function r(t){e[2](t)}function i(t){e[3](t)}let c={};return void 0!==e[0]&&(c.mailbox=e[0]),void 0!==e[1]&&(c.messages=e[1]),t=new kt({props:c}),H.push((()=>J(t,"mailbox",r))),H.push((()=>J(t,"messages",i))),{c(){a(t.$$.fragment)},l(e){o(t.$$.fragment,e)},m(e,s){f(t,e,s),l=!0},p(e,a){const l={};!s&&1&a&&(s=!0,l.mailbox=e[0],L((()=>s=!1))),!n&&2&a&&(n=!0,l.messages=e[1],L((()=>n=!1))),t.$set(l)},i(e){l||($(t.$$.fragment,e),l=!0)},o(e){u(t.$$.fragment,e),l=!1},d(e){d(t,e)}}}function It(e){let t,n,a,l,r=e[0].id;document.title=t=(e[0].unseen?`(${e[0].unseen}) `:"")+de(e[0]);let o=yt(e);return{c(){n=g(),o.c(),a=O()},l(e){ce('[data-svelte="svelte-1c3uss9"]',document.head).forEach(i),n=v(e),o.l(e),a=O()},m(e,t){m(e,n,t),o.m(e,t),m(e,a,t),l=!0},p(e,[n]){(!l||1&n)&&t!==(t=(e[0].unseen?`(${e[0].unseen}) `:"")+de(e[0]))&&(document.title=t),1&n&&s(r,r=e[0].id)?(E(),u(o,1,1,ae),k(),o=yt(e),o.c(),$(o),o.m(a.parentNode,a)):o.p(e,n)},i(e){l||($(o),l=!0)},o(e){u(o),l=!1},d(e){e&&i(n),e&&i(a),o.d(e)}}}const jt=({page:e,fetch:t,session:s})=>De({page:e,fetch:t,session:s});function Vt(e,t,s){let{mailbox:n}=t,{messages:a}=t;return e.$$set=e=>{"mailbox"in e&&s(0,n=e.mailbox),"messages"in e&&s(1,a=e.messages)},[n,a,function(e){n=e,s(0,n)},function(e){a=e,s(1,a)}]}class Tt extends e{constructor(e){super(),t(this,e,Vt,It,s,{mailbox:0,messages:1})}}export{Tt as default,jt as load};
