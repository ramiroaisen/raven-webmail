import{b5 as e,S as t,i as n,s as a,e as s,j as l,c as r,a as o,m as c,d as i,b as u,f,o as m,x as $,u as d,v as h,k as g,t as v,n as p,g as x,G as b,H as w,I as y,U as j,V as E,J as D,r as I,w as k,h as V,a3 as _,N as M,aI as q,aR as T,aS as C,aT as P,aU as R,b6 as S,E as N,O as U,aV as A,l as L,ax as H,aW as z,W as K,aX as W,K as B,ac as F,aK as G,D as J,aY as O,aZ as Q,Q as X,b0 as Y,y as Z,F as ee,P as te,a$ as ne,L as ae,a0 as se,ad as le,b7 as re,a1 as oe,$ as ce}from"../chunks/vendor-dd04488f.js";import{m as ie,r as ue,b as fe,d as me,f as $e,e as de,_ as he,n as ge,l as ve,g as pe}from"../chunks/util-b32c90e7.js";import{t as xe,a as be}from"../chunks/MenuItem-338ffe8c.js";import{R as we}from"../chunks/Ripple-5f31ea97.js";import{a as ye,C as je}from"../chunks/compose-7c960461.js";import{T as Ee}from"../chunks/TabTop-3ebc66da.js";import{l as De}from"../chunks/locale-5d944b89.js";import"../chunks/singletons-12a22614.js";import"../chunks/preload-helper-ec9aa979.js";function Ie(e){let t,n;return t=new T({}),{c(){l(t.$$.fragment)},l(e){c(t.$$.fragment,e)},m(e,a){m(t,e,a),n=!0},i(e){n||($(t.$$.fragment,e),n=!0)},o(e){d(t.$$.fragment,e),n=!1},d(e){h(t,e)}}}function ke(e){let t,n;return t=new C({}),{c(){l(t.$$.fragment)},l(e){c(t.$$.fragment,e)},m(e,a){m(t,e,a),n=!0},i(e){n||($(t.$$.fragment,e),n=!0)},o(e){d(t.$$.fragment,e),n=!1},d(e){h(t,e)}}}function Ve(e){let t,n;return t=new P({}),{c(){l(t.$$.fragment)},l(e){c(t.$$.fragment,e)},m(e,a){m(t,e,a),n=!0},i(e){n||($(t.$$.fragment,e),n=!0)},o(e){d(t.$$.fragment,e),n=!1},d(e){h(t,e)}}}function _e(e){let t,n;return t=new R({}),{c(){l(t.$$.fragment)},l(e){c(t.$$.fragment,e)},m(e,a){m(t,e,a),n=!0},i(e){n||($(t.$$.fragment,e),n=!0)},o(e){d(t.$$.fragment,e),n=!1},d(e){h(t,e)}}}function Me(e){let t,n,a;return n=new q({}),{c(){t=s("div"),l(n.$$.fragment),this.h()},l(e){t=r(e,"DIV",{class:!0});var a=o(t);c(n.$$.fragment,a),a.forEach(i),this.h()},h(){u(t,"class","attachments svelte-2a05jv")},m(e,s){f(e,t,s),m(n,t,null),a=!0},i(e){a||($(n.$$.fragment,e),a=!0)},o(e){d(n.$$.fragment,e),a=!1},d(e){e&&i(t),h(n)}}}function qe(e){let t,n,a,q,T,C,P,R,S,N,U,A,L,H,z,K,W,B,F,G,J,O,Q,X,Y,Z,ee,te,ne,ae,se,le,re,oe,ce,fe,me,$e,de,he,ge=Te(e[2],e[0])+"",ve=ie(e[2])+"",pe=(e[0].subject||"")+"",xe=(e[0].intro||"")+"",be=ue(e[0].date)+"";const ye=[ke,Ie],je=[];function Ee(e,t){return e[3]?0:1}a=Ee(e),q=je[a]=ye[a](e),C=new we({});const De=[_e,Ve],qe=[];function Ce(e,t){return e[0].flagged?0:1}S=Ce(e),N=qe[S]=De[S](e),A=new we({});let Pe=e[0].attachments&&Me();return{c(){t=s("a"),n=s("div"),q.c(),T=g(),l(C.$$.fragment),P=g(),R=s("div"),N.c(),U=g(),l(A.$$.fragment),L=g(),H=s("div"),z=s("div"),K=v(ge),B=g(),F=s("div"),G=s("div"),J=s("div"),O=v(ve),Q=g(),X=s("div"),Y=s("span"),Z=v(pe),te=g(),ne=s("span"),ae=v(xe),le=g(),re=s("div"),oe=s("div"),ce=v(be),fe=g(),Pe&&Pe.c(),this.h()},l(e){t=r(e,"A",{href:!0,class:!0});var a=o(t);n=r(a,"DIV",{class:!0});var s=o(n);q.l(s),T=p(s),c(C.$$.fragment,s),s.forEach(i),P=p(a),R=r(a,"DIV",{class:!0});var l=o(R);N.l(l),U=p(l),c(A.$$.fragment,l),l.forEach(i),L=p(a),H=r(a,"DIV",{class:!0});var u=o(H);z=r(u,"DIV",{class:!0});var f=o(z);K=x(f,ge),f.forEach(i),B=p(u),F=r(u,"DIV",{class:!0});var m=o(F);G=r(m,"DIV",{class:!0});var $=o(G);J=r($,"DIV",{class:!0});var d=o(J);O=x(d,ve),d.forEach(i),Q=p($),X=r($,"DIV",{class:!0});var h=o(X);Y=r(h,"SPAN",{class:!0});var g=o(Y);Z=x(g,pe),g.forEach(i),te=p(h),ne=r(h,"SPAN",{class:!0});var v=o(ne);ae=x(v,xe),v.forEach(i),h.forEach(i),$.forEach(i),le=p(m),re=r(m,"DIV",{class:!0});var b=o(re);oe=r(b,"DIV",{class:!0});var w=o(oe);ce=x(w,be),w.forEach(i),fe=p(b),Pe&&Pe.l(b),b.forEach(i),m.forEach(i),u.forEach(i),a.forEach(i),this.h()},h(){u(n,"class","select cell-icon btn-dark svelte-2a05jv"),u(R,"class","cell-icon btn-dark flag svelte-2a05jv"),u(z,"class","from svelte-2a05jv"),u(J,"class","mailbox svelte-2a05jv"),u(Y,"class","subject svelte-2a05jv"),u(ne,"class","intro svelte-2a05jv"),u(X,"class","subject-intro svelte-2a05jv"),u(G,"class","mailbox-subject-intro svelte-2a05jv"),u(oe,"class","date svelte-2a05jv"),u(re,"class","date-attachments svelte-2a05jv"),u(F,"class","end svelte-2a05jv"),u(H,"class","flex svelte-2a05jv"),u(t,"href",me="/mailbox/"+e[2].id+"/message/"+e[0].id),u(t,"class","na message svelte-2a05jv"),b(t,"seen",e[0].seen),b(t,"selected",e[3]),b(t,"flagged",e[0].flagged)},m(s,l){f(s,t,l),w(t,n),je[a].m(n,null),w(n,T),m(C,n,null),w(t,P),w(t,R),qe[S].m(R,null),w(R,U),m(A,R,null),w(t,L),w(t,H),w(H,z),w(z,K),w(H,B),w(H,F),w(F,G),w(G,J),w(J,O),w(G,Q),w(G,X),w(X,Y),w(Y,Z),w(X,te),w(X,ne),w(ne,ae),w(F,le),w(F,re),w(re,oe),w(oe,ce),w(re,fe),Pe&&Pe.m(re,null),$e=!0,de||(he=[y(n,"click",j(E(e[4]))),y(R,"click",j(E(e[5]))),D(W=e[7].call(null,z,e[1])),D(ee=e[7].call(null,Y,e[1])),D(se=e[7].call(null,ne,e[1])),y(t,"click",e[6])],de=!0)},p(e,[s]){let l=a;a=Ee(e),a!==l&&(I(),d(je[l],1,1,(()=>{je[l]=null})),k(),q=je[a],q||(q=je[a]=ye[a](e),q.c()),$(q,1),q.m(n,T));let r=S;S=Ce(e),S!==r&&(I(),d(qe[r],1,1,(()=>{qe[r]=null})),k(),N=qe[S],N||(N=qe[S]=De[S](e),N.c()),$(N,1),N.m(R,U)),(!$e||5&s)&&ge!==(ge=Te(e[2],e[0])+"")&&V(K,ge),W&&_(W.update)&&2&s&&W.update.call(null,e[1]),(!$e||4&s)&&ve!==(ve=ie(e[2])+"")&&V(O,ve),(!$e||1&s)&&pe!==(pe=(e[0].subject||"")+"")&&V(Z,pe),ee&&_(ee.update)&&2&s&&ee.update.call(null,e[1]),(!$e||1&s)&&xe!==(xe=(e[0].intro||"")+"")&&V(ae,xe),se&&_(se.update)&&2&s&&se.update.call(null,e[1]),(!$e||1&s)&&be!==(be=ue(e[0].date)+"")&&V(ce,be),e[0].attachments?Pe?1&s&&$(Pe,1):(Pe=Me(),Pe.c(),$(Pe,1),Pe.m(re,null)):Pe&&(I(),d(Pe,1,1,(()=>{Pe=null})),k()),(!$e||5&s&&me!==(me="/mailbox/"+e[2].id+"/message/"+e[0].id))&&u(t,"href",me),1&s&&b(t,"seen",e[0].seen),8&s&&b(t,"selected",e[3]),1&s&&b(t,"flagged",e[0].flagged)},i(e){$e||($(q),$(C.$$.fragment,e),$(N),$(A.$$.fragment,e),$(Pe),$e=!0)},o(e){d(q),d(C.$$.fragment,e),d(N),d(A.$$.fragment,e),d(Pe),$e=!1},d(e){e&&i(t),je[a].d(),h(C),qe[S].d(),h(A),Pe&&Pe.d(),de=!1,M(he)}}}const Te=(e,t)=>{var n,a;return"\\Drafts"===e.specialUse||"\\Sent"===e.specialUse?`To: ${(null===(n=t.to[0])||void 0===n?void 0:n.name)||(null===(a=t.to[0])||void 0===a?void 0:a.address)||""}`:t.from.name||t.from.address||""},Ce=e.exports.toString();function Pe(e,t,n){let a;var s=this&&this.__awaiter||function(e,t,n,a){return new(n||(n=Promise))((function(s,l){function r(e){try{c(a.next(e))}catch(t){l(t)}}function o(e){try{c(a.throw(e))}catch(t){l(t)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,o)}c((a=a.apply(e,t||[])).next())}))};let{query:l}=t,{mailbox:r}=t,{message:o}=t,{selection:c=[]}=t;const i=fe((()=>s(void 0,void 0,void 0,(function*(){n(0,o.flagged=!o.flagged,o),yield me(`/api/mailboxes/${r.id}/messages/${o.id}/flag`,{value:o.flagged}).catch((e=>{throw n(0,o.flagged=!o.flagged,o),e}))})))),u=fe((e=>s(void 0,void 0,void 0,(function*(){$e(r)&&(e.preventDefault(),e.stopPropagation(),yield ye(r,o.id))}))));return e.$$set=e=>{"query"in e&&n(1,l=e.query),"mailbox"in e&&n(2,r=e.mailbox),"message"in e&&n(0,o=e.message),"selection"in e&&n(8,c=e.selection)},e.$$.update=()=>{257&e.$$.dirty&&n(3,a=c.some((e=>e.mailbox===o.mailbox&&e.id===o.id)))},[o,l,r,a,()=>{const e=c.filter((e=>e.id!==o.id));n(8,c=a?e:[...e,o])},i,u,(e,t)=>{const n=e.textContent,a=t=>{const a=t.split(/\s+/g);if(0===a.length)return void(e.textContent=n);const s=new RegExp(a.map((e=>Ce(S(e)))).join("|"),"ig"),l=n.replace(s,(e=>{const t=document.createElement("span");return t.textContent=e,t.classList.add("highlight"),t.outerHTML}));e.innerHTML=l};return a(t),{update:a}},c]}class Re extends t{constructor(e){super(),n(this,e,Pe,qe,a,{query:1,mailbox:2,message:0,selection:8})}}function Se(e){let t,n;return t=new z({}),{c(){l(t.$$.fragment)},l(e){c(t.$$.fragment,e)},m(e,a){m(t,e,a),n=!0},i(e){n||($(t.$$.fragment,e),n=!0)},o(e){d(t.$$.fragment,e),n=!1},d(e){h(t,e)}}}function Ne(e){let t,n;return t=new C({}),{c(){l(t.$$.fragment)},l(e){c(t.$$.fragment,e)},m(e,a){m(t,e,a),n=!0},i(e){n||($(t.$$.fragment,e),n=!0)},o(e){d(t.$$.fragment,e),n=!1},d(e){h(t,e)}}}function Ue(e){let t,n;return t=new T({}),{c(){l(t.$$.fragment)},l(e){c(t.$$.fragment,e)},m(e,a){m(t,e,a),n=!0},i(e){n||($(t.$$.fragment,e),n=!0)},o(e){d(t.$$.fragment,e),n=!1},d(e){h(t,e)}}}function Ae(e){let t,n,a,b,j,E,q,T,C,P,R,S,N,U,A,L,H,z,J,O,Q,X,Y=e[1].length+"";const Z=[ze,He],ee=[];function te(e,t){return(null==a||2&t)&&(a=!e[1].every(Oe)),a?0:1}function ne(e,t){return 1===e[1].length?We:Ke}b=te(e,-1),j=ee[b]=Z[b](e),T=new K({}),P=new we({}),U=new W({});let ae=ne(e),se=ae(e);return{c(){t=s("div"),n=s("div"),j.c(),E=g(),q=s("div"),l(T.$$.fragment),C=g(),l(P.$$.fragment),S=g(),N=s("div"),l(U.$$.fragment),A=g(),L=s("span"),H=v(Y),z=g(),se.c(),this.h()},l(e){t=r(e,"DIV",{class:!0});var a=o(t);n=r(a,"DIV",{class:!0});var s=o(n);j.l(s),E=p(s),q=r(s,"DIV",{class:!0});var l=o(q);c(T.$$.fragment,l),C=p(l),c(P.$$.fragment,l),l.forEach(i),s.forEach(i),S=p(a),N=r(a,"DIV",{class:!0});var u=o(N);c(U.$$.fragment,u),A=p(u),L=r(u,"SPAN",{class:!0});var f=o(L);H=x(f,Y),z=p(f),se.l(f),f.forEach(i),u.forEach(i),a.forEach(i),this.h()},h(){u(q,"class","action btn-dark"),u(n,"class","action-group"),u(L,"class","svelte-ejn2om"),u(N,"class","selection-info svelte-ejn2om"),u(t,"class","only-when-selection svelte-ejn2om")},m(a,s){f(a,t,s),w(t,n),ee[b].m(n,null),w(n,E),w(n,q),m(T,q,null),w(q,C),m(P,q,null),w(t,S),w(t,N),m(U,N,null),w(N,A),w(N,L),w(L,H),w(L,z),se.m(L,null),O=!0,Q||(X=[D(R=xe.call(null,q,e[5].Delete)),y(q,"click",e[9])],Q=!0)},p(e,t){let a=b;b=te(e,t),b===a?ee[b].p(e,t):(I(),d(ee[a],1,1,(()=>{ee[a]=null})),k(),j=ee[b],j?j.p(e,t):(j=ee[b]=Z[b](e),j.c()),$(j,1),j.m(n,E)),R&&_(R.update)&&32&t&&R.update.call(null,e[5].Delete),(!O||2&t)&&Y!==(Y=e[1].length+"")&&V(H,Y),ae===(ae=ne(e))&&se?se.p(e,t):(se.d(1),se=ae(e),se&&(se.c(),se.m(L,null)))},i(e){O||($(j),$(T.$$.fragment,e),$(P.$$.fragment,e),$(U.$$.fragment,e),e&&(J||B((()=>{J=F(t,G,{duration:200}),J.start()}))),O=!0)},o(e){d(j),d(T.$$.fragment,e),d(P.$$.fragment,e),d(U.$$.fragment,e),O=!1},d(e){e&&i(t),ee[b].d(),h(T),h(P),h(U),se.d(),Q=!1,M(X)}}}function Le(e){let t;function n(e,t){return 1===e[2]?Fe:Be}let a=n(e),l=a(e);return{c(){t=s("div"),l.c(),this.h()},l(e){t=r(e,"DIV",{class:!0});var n=o(t);l.l(n),n.forEach(i),this.h()},h(){u(t,"class","count svelte-ejn2om")},m(e,n){f(e,t,n),l.m(t,null)},p(e,s){a===(a=n(e))&&l?l.p(e,s):(l.d(1),l=a(e),l&&(l.c(),l.m(t,null)))},i:J,o:J,d(e){e&&i(t),l.d()}}}function He(e){let t,n,a,v,x,b,j,E;return n=new O({}),v=new we({}),{c(){t=s("div"),l(n.$$.fragment),a=g(),l(v.$$.fragment),this.h()},l(e){t=r(e,"DIV",{class:!0});var s=o(t);c(n.$$.fragment,s),a=p(s),c(v.$$.fragment,s),s.forEach(i),this.h()},h(){u(t,"class","action btn-dark")},m(s,l){f(s,t,l),m(n,t,null),w(t,a),m(v,t,null),b=!0,j||(E=[D(x=xe.call(null,t,e[5].Mark_as_not_seen)),y(t,"click",e[13])],j=!0)},p(e,t){x&&_(x.update)&&32&t&&x.update.call(null,e[5].Mark_as_not_seen)},i(e){b||($(n.$$.fragment,e),$(v.$$.fragment,e),b=!0)},o(e){d(n.$$.fragment,e),d(v.$$.fragment,e),b=!1},d(e){e&&i(t),h(n),h(v),j=!1,M(E)}}}function ze(e){let t,n,a,v,x,b,j,E;return n=new Q({}),v=new we({}),{c(){t=s("div"),l(n.$$.fragment),a=g(),l(v.$$.fragment),this.h()},l(e){t=r(e,"DIV",{class:!0});var s=o(t);c(n.$$.fragment,s),a=p(s),c(v.$$.fragment,s),s.forEach(i),this.h()},h(){u(t,"class","action btn-dark")},m(s,l){f(s,t,l),m(n,t,null),w(t,a),m(v,t,null),b=!0,j||(E=[D(x=xe.call(null,t,e[5].Mark_as_seen)),y(t,"click",e[12])],j=!0)},p(e,t){x&&_(x.update)&&32&t&&x.update.call(null,e[5].Mark_as_seen)},i(e){b||($(n.$$.fragment,e),$(v.$$.fragment,e),b=!0)},o(e){d(n.$$.fragment,e),d(v.$$.fragment,e),b=!1},d(e){e&&i(t),h(n),h(v),j=!1,M(E)}}}function Ke(e){let t,n=e[5].messages+"";return{c(){t=v(n)},l(e){t=x(e,n)},m(e,n){f(e,t,n)},p(e,a){32&a&&n!==(n=e[5].messages+"")&&V(t,n)},d(e){e&&i(t)}}}function We(e){let t,n=e[5].message+"";return{c(){t=v(n)},l(e){t=x(e,n)},m(e,n){f(e,t,n)},p(e,a){32&a&&n!==(n=e[5].message+"")&&V(t,n)},d(e){e&&i(t)}}}function Be(e){let t,n,a,s=e[5].messages+"";return{c(){t=v(e[2]),n=g(),a=v(s)},l(l){t=x(l,e[2]),n=p(l),a=x(l,s)},m(e,s){f(e,t,s),f(e,n,s),f(e,a,s)},p(e,n){4&n&&V(t,e[2]),32&n&&s!==(s=e[5].messages+"")&&V(a,s)},d(e){e&&i(t),e&&i(n),e&&i(a)}}}function Fe(e){let t,n,a=e[5].message+"";return{c(){t=v("1 "),n=v(a)},l(e){t=x(e,"1 "),n=x(e,a)},m(e,a){f(e,t,a),f(e,n,a)},p(e,t){32&t&&a!==(a=e[5].message+"")&&V(n,a)},d(e){e&&i(t),e&&i(n)}}}function Ge(e){let t,n,a,v,x,b,j,E,V,q,T,C,P,R,S,N,U,z,K,W;const B=[Ue,Ne,Se],F=[];function G(e,t){return 0===e[1].length?0:e[1].length===e[0].length?1:2}a=G(e),v=F[a]=B[a](e),b=new we({}),q=new A({}),C=new we({});const J=[Le,Ae],O=[];function Q(e,t){return 0===e[1].length&&0!==e[2]?0:0!==e[1].length?1:-1}return~(S=Q(e))&&(N=O[S]=J[S](e)),{c(){t=s("div"),n=s("div"),v.c(),x=g(),l(b.$$.fragment),j=g(),E=s("div"),V=s("div"),l(q.$$.fragment),T=g(),l(C.$$.fragment),R=g(),N&&N.c(),U=L(),this.h()},l(e){t=r(e,"DIV",{class:!0});var a=o(t);n=r(a,"DIV",{class:!0});var s=o(n);v.l(s),x=p(s),c(b.$$.fragment,s),s.forEach(i),j=p(a),E=r(a,"DIV",{class:!0});var l=o(E);V=r(l,"DIV",{class:!0,style:!0});var u=o(V);c(q.$$.fragment,u),u.forEach(i),T=p(l),c(C.$$.fragment,l),l.forEach(i),a.forEach(i),R=p(e),N&&N.l(e),U=L(),this.h()},h(){u(n,"class","action btn-dark"),u(V,"class","reload-inner svelte-ejn2om"),H(V,"transform","rotate("+360*e[4]+"deg)"),u(E,"class","action btn-dark reload"),u(t,"class","action-group select svelte-ejn2om")},m(s,l){f(s,t,l),w(t,n),F[a].m(n,null),w(n,x),m(b,n,null),w(t,j),w(t,E),w(E,V),m(q,V,null),w(E,T),m(C,E,null),f(s,R,l),~S&&O[S].m(s,l),f(s,U,l),z=!0,K||(W=[y(n,"click",e[10]),D(P=xe.call(null,E,e[5].Reload)),y(E,"click",e[7])],K=!0)},p(e,t){let s=a;a=G(e),a!==s&&(I(),d(F[s],1,1,(()=>{F[s]=null})),k(),v=F[a],v||(v=F[a]=B[a](e),v.c()),$(v,1),v.m(n,x)),(!z||16&t)&&H(V,"transform","rotate("+360*e[4]+"deg)"),P&&_(P.update)&&32&t&&P.update.call(null,e[5].Reload);let l=S;S=Q(e),S===l?~S&&O[S].p(e,t):(N&&(I(),d(O[l],1,1,(()=>{O[l]=null})),k()),~S?(N=O[S],N?N.p(e,t):(N=O[S]=J[S](e),N.c()),$(N,1),N.m(U.parentNode,U)):N=null)},i(e){z||($(v),$(b.$$.fragment,e),$(q.$$.fragment,e),$(C.$$.fragment,e),$(N),z=!0)},o(e){d(v),d(b.$$.fragment,e),d(q.$$.fragment,e),d(C.$$.fragment,e),d(N),z=!1},d(e){e&&i(t),F[a].d(),h(b),h(q),h(C),e&&i(R),~S&&O[S].d(e),e&&i(U),K=!1,M(W)}}}function Je(e){let t,n;return t=new Ee({props:{scrolled:e[3],$$slots:{default:[Ge]},$$scope:{ctx:e}}}),{c(){l(t.$$.fragment)},l(e){c(t.$$.fragment,e)},m(e,a){m(t,e,a),n=!0},p(e,[n]){const a={};8&n&&(a.scrolled=e[3]),1048631&n&&(a.$$scope={dirty:n,ctx:e}),t.$set(a)},i(e){n||($(t.$$.fragment,e),n=!0)},o(e){d(t.$$.fragment,e),n=!1},d(e){h(t,e)}}}const Oe=e=>e.seen;function Qe(e,t,n){let a,s;N(e,De,(e=>n(5,s=e)));var l=this&&this.__awaiter||function(e,t,n,a){return new(n||(n=Promise))((function(s,l){function r(e){try{c(a.next(e))}catch(t){l(t)}}function o(e){try{c(a.throw(e))}catch(t){l(t)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,o)}c((a=a.apply(e,t||[])).next())}))};let{results:r}=t,{selection:o}=t,{total:c}=t,{scrolled:i=!1}=t,{mailboxMap:u}=t;const{prev:f,next:m}=U("search"),{mailboxes:$}=U("dash");N(e,$,(e=>n(14,a=e)));let d=0;const h=fe((e=>l(void 0,void 0,void 0,(function*(){if(0===o.length)return;const t=new Map;for(const e of o){const n=t.get(e.mailbox);null==n?t.set(e.mailbox,[e.id]):n.push(e.id)}const a=[];for(const[n,s]of t.entries())a.push(me(`/api/mailboxes/${n}/messages`,{message:s.join(","),seen:e}));yield Promise.all(a);for(const n of o)n.seen=e;n(0,r=[...r]),n(1,o=[...o])})))),g=fe((()=>l(void 0,void 0,void 0,(function*(){if(0===o.length)return;const e=a.find(de),t=[],n=new Map;for(const a of o){const e=u.get(a.mailbox);if(de(e)||$e(e))console.log("delete"),t.push(he(`/api/mailboxes/${a.mailbox}/messages/${a.id}`));else{console.log("move");const e=n.get(a.mailbox);e?e.push(a.id):n.set(a.mailbox,[a.id])}}for(const[a,s]of n.entries())t.push(me(`/api/mailboxes/${a}/messages`,{message:s.join(","),moveTo:e.id}));yield Promise.all(t),v()})))),v=()=>{const e=o.map((e=>`${e.mailbox}-${e.id}`));n(0,r=r.filter((t=>!e.includes(`${t.mailbox}-${t.id}`)))),r.length<25&&setTimeout(m,10),n(1,o=[])};return e.$$set=e=>{"results"in e&&n(0,r=e.results),"selection"in e&&n(1,o=e.selection),"total"in e&&n(2,c=e.total),"scrolled"in e&&n(3,i=e.scrolled),"mailboxMap"in e&&n(11,u=e.mailboxMap)},[r,o,c,i,d,s,$,()=>{n(4,d++,d),f()},h,g,()=>{o.length===r.length?n(1,o=[]):n(1,o=r.slice())},u,()=>h(!0),()=>h(!1)]}class Xe extends t{constructor(e){super(),n(this,e,Qe,Je,a,{results:0,selection:1,total:2,scrolled:3,mailboxMap:11})}}const{Map:Ye}=re;function Ze(e,t,n){const a=e.slice();return a[23]=t[n],a[24]=t,a[25]=n,a}function et(e){let t,n,a,l,c=e[8].There_are_no_search_results_for_this_query+"";return{c(){t=s("div"),n=s("div"),a=v(c),this.h()},l(e){t=r(e,"DIV",{class:!0});var s=o(t);n=r(s,"DIV",{class:!0});var l=o(n);a=x(l,c),l.forEach(i),s.forEach(i),this.h()},h(){u(n,"class","empty svelte-1j01euu"),u(t,"class","empty-wrap")},m(e,s){f(e,t,s),w(t,n),w(n,a)},p(e,t){256&t&&c!==(c=e[8].There_are_no_search_results_for_this_query+"")&&V(a,c)},i(n){n&&(l||B((()=>{l=F(t,e[11],{duration:250}),l.start()})))},o:J,d(e){e&&i(t)}}}function tt(e){let t,n,a,l,c,m,h,v=[],x=new Ye,b=e[0];const w=e=>`${e[23].mailbox}-${e[23].id}`;for(let s=0;s<b.length;s+=1){let t=Ze(e,b,s),n=w(t);x.set(n,v[s]=nt(n,t))}const y=[st,at],j=[];function E(e,t){return e[6]?0:e[1]?1:-1}return~(c=E(e))&&(m=j[c]=y[c](e)),{c(){t=s("div");for(let e=0;e<v.length;e+=1)v[e].c();a=g(),l=s("div"),m&&m.c(),this.h()},l(e){t=r(e,"DIV",{class:!0});var n=o(t);for(let t=0;t<v.length;t+=1)v[t].l(n);n.forEach(i),a=p(e),l=r(e,"DIV",{class:!0});var s=o(l);m&&m.l(s),s.forEach(i),this.h()},h(){u(t,"class","messages"),u(l,"class","next-wrap svelte-1j01euu")},m(e,n){f(e,t,n);for(let a=0;a<v.length;a+=1)v[a].m(t,null);f(e,a,n),f(e,l,n),~c&&j[c].m(l,null),h=!0},p(e,n){149&n&&(b=e[0],I(),v=se(v,n,w,1,e,b,x,t,oe,nt,null,Ze),k());let a=c;c=E(e),c===a?~c&&j[c].p(e,n):(m&&(I(),d(j[a],1,1,(()=>{j[a]=null})),k()),~c?(m=j[c],m?m.p(e,n):(m=j[c]=y[c](e),m.c()),$(m,1),m.m(l,null)):m=null)},i(a){if(!h){for(let e=0;e<b.length;e+=1)$(v[e]);a&&B((()=>{n||(n=ae(t,e[11],{duration:250},!0)),n.run(1)})),$(m),h=!0}},o(a){for(let e=0;e<v.length;e+=1)d(v[e]);a&&(n||(n=ae(t,e[11],{duration:250},!1)),n.run(0)),d(m),h=!1},d(e){e&&i(t);for(let t=0;t<v.length;t+=1)v[t].d();e&&n&&n.end(),e&&i(a),e&&i(l),~c&&j[c].d()}}}function nt(e,t){let n,a,v,x,b,y,j;function E(e){t[16](e,t[23],t[24],t[25])}function D(e){t[17](e)}let I={mailbox:t[7].get(t[23].mailbox),query:t[2]};return void 0!==t[23]&&(I.message=t[23]),void 0!==t[4]&&(I.selection=t[4]),a=new Re({props:I}),ee.push((()=>te(a,"message",E))),ee.push((()=>te(a,"selection",D))),{key:e,first:null,c(){n=s("div"),l(a.$$.fragment),b=g(),this.h()},l(e){n=r(e,"DIV",{class:!0});var t=o(n);c(a.$$.fragment,t),b=p(t),t.forEach(i),this.h()},h(){u(n,"class","message"),this.first=n},m(e,t){f(e,n,t),m(a,n,null),w(n,b),j=!0},p(e,n){t=e;const s={};129&n&&(s.mailbox=t[7].get(t[23].mailbox)),4&n&&(s.query=t[2]),!v&&1&n&&(v=!0,s.message=t[23],X((()=>v=!1))),!x&&16&n&&(x=!0,s.selection=t[4],X((()=>x=!1))),a.$set(s)},i(e){j||($(a.$$.fragment,e),e&&B((()=>{y||(y=ae(n,t[11],{duration:250},!0)),y.run(1)})),j=!0)},o(e){d(a.$$.fragment,e),e&&(y||(y=ae(n,t[11],{duration:250},!1)),y.run(0)),j=!1},d(e){e&&i(n),h(a),e&&y&&y.end()}}}function at(e){let t,n,a,v,x,b,j;return n=new ce({}),v=new we({}),{c(){t=s("div"),l(n.$$.fragment),a=g(),l(v.$$.fragment),this.h()},l(e){t=r(e,"DIV",{class:!0});var s=o(t);c(n.$$.fragment,s),a=p(s),c(v.$$.fragment,s),s.forEach(i),this.h()},h(){u(t,"class","next btn-dark svelte-1j01euu")},m(s,l){f(s,t,l),m(n,t,null),w(t,a),m(v,t,null),x=!0,b||(j=y(t,"click",e[10]),b=!0)},p:J,i(e){x||($(n.$$.fragment,e),$(v.$$.fragment,e),x=!0)},o(e){d(n.$$.fragment,e),d(v.$$.fragment,e),x=!1},d(e){e&&i(t),h(n),h(v),b=!1,j()}}}function st(e){let t,n,a;return n=new je({}),{c(){t=s("div"),l(n.$$.fragment),this.h()},l(e){t=r(e,"DIV",{class:!0});var a=o(t);c(n.$$.fragment,a),a.forEach(i),this.h()},h(){u(t,"class","loading-more svelte-1j01euu")},m(e,s){f(e,t,s),m(n,t,null),a=!0},p:J,i(e){a||($(n.$$.fragment,e),a=!0)},o(e){d(n.$$.fragment,e),a=!1},d(e){e&&i(t),h(n)}}}function lt(e){let t,n,a,v,x,b,y,j,E,V,_,M;function q(t){e[14](t)}function T(t){e[15](t)}let C={scrolled:e[5],total:e[3],mailboxMap:e[7]};void 0!==e[0]&&(C.results=e[0]),void 0!==e[4]&&(C.selection=e[4]),n=new Xe({props:C}),ee.push((()=>te(n,"results",q))),ee.push((()=>te(n,"selection",T)));const P=[tt,et],R=[];function S(e,t){return e[0].length||e[6]?0:1}return y=S(e),j=R[y]=P[y](e),{c(){t=s("div"),l(n.$$.fragment),x=g(),b=s("div"),j.c(),this.h()},l(e){t=r(e,"DIV",{class:!0});var a=o(t);c(n.$$.fragment,a),x=p(a),b=r(a,"DIV",{class:!0});var s=o(b);j.l(s),s.forEach(i),a.forEach(i),this.h()},h(){u(b,"class","content svelte-1j01euu"),u(t,"class","search svelte-1j01euu")},m(a,s){f(a,t,s),m(n,t,null),w(t,x),w(t,b),R[y].m(b,null),V=!0,_||(M=D(e[12].call(null,b)),_=!0)},p(e,t){const s={};32&t&&(s.scrolled=e[5]),8&t&&(s.total=e[3]),128&t&&(s.mailboxMap=e[7]),!a&&1&t&&(a=!0,s.results=e[0],X((()=>a=!1))),!v&&16&t&&(v=!0,s.selection=e[4],X((()=>v=!1))),n.$set(s);let l=y;y=S(e),y===l?R[y].p(e,t):(I(),d(R[l],1,1,(()=>{R[l]=null})),k(),j=R[y],j?j.p(e,t):(j=R[y]=P[y](e),j.c()),$(j,1),j.m(b,null))},i(e){V||($(n.$$.fragment,e),$(j),E||B((()=>{E=F(b,le,{duration:150,y:-15}),E.start()})),V=!0)},o(e){d(n.$$.fragment,e),d(j),V=!1},d(e){e&&i(t),h(n),R[y].d(),_=!1,M()}}}function rt(e){let t,n,s,l,r=e[2];document.title=t=e[2];let o=lt(e);return{c(){n=g(),o.c(),s=L()},l(e){Y('[data-svelte="svelte-1cx3okz"]',document.head).forEach(i),n=p(e),o.l(e),s=L()},m(e,t){f(e,n,t),o.m(e,t),f(e,s,t),l=!0},p(e,[n]){(!l||4&n)&&t!==(t=e[2])&&(document.title=t),4&n&&a(r,r=e[2])?(I(),d(o,1,1,J),k(),o=lt(e),o.c(),$(o),o.m(s.parentNode,s)):o.p(e,n)},i(e){l||($(o),l=!0)},o(e){d(o),l=!1},d(e){e&&i(n),e&&i(s),o.d(e)}}}var ot=function(e,t,n,a){return new(n||(n=Promise))((function(s,l){function r(e){try{c(a.next(e))}catch(t){l(t)}}function o(e){try{c(a.throw(e))}catch(t){l(t)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,o)}c((a=a.apply(e,t||[])).next())}))};const ct=({page:e,fetch:t,session:n})=>ot(void 0,void 0,void 0,(function*(){return yield ge({page:e,fetch:t,session:n})}));function it(e,t,n){let a,s,l;N(e,De,(e=>n(8,l=e)));var r=this&&this.__awaiter||function(e,t,n,a){return new(n||(n=Promise))((function(s,l){function r(e){try{c(a.next(e))}catch(t){l(t)}}function o(e){try{c(a.throw(e))}catch(t){l(t)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,o)}c((a=a.apply(e,t||[])).next())}))};let{query:o}=t,{results:c}=t,{nextCursor:i}=t,{total:u}=t,f=[],m=!1;const{mailboxes:$}=U("dash");N(e,$,(e=>n(13,s=e)));let d=!1;const h=fe((()=>r(void 0,void 0,void 0,(function*(){if(i){n(6,d=!0);try{const e=yield ve(`/api/search?next=${i}&limit=50`);n(0,c=(e=>{const t=[];for(const n of e)t.some((e=>e.mailbox===n.mailbox&&e.id===n.id))||t.push(n);return t})([...c,...e.results])),n(1,i=e.nextCursor),n(6,d=!1)}catch(e){throw n(6,d=!1),e}}})))),g=fe((()=>r(void 0,void 0,void 0,(function*(){yield pe(`/search?query=${encodeURIComponent(o)}&now=${Date.now()}`,{replaceState:!0,keepfocus:!0})}))));Z("search",{next:h,prev:g});return e.$$set=e=>{"query"in e&&n(2,o=e.query),"results"in e&&n(0,c=e.results),"nextCursor"in e&&n(1,i=e.nextCursor),"total"in e&&n(3,u=e.total)},e.$$.update=()=>{8192&e.$$.dirty&&n(7,a=(e=>{const t=new Map;for(const n of e)t.set(n.id,n);return t})(s))},[c,i,o,u,f,m,d,a,l,$,h,(e,{delay:t=0,duration:n=400,easing:a=ne}={})=>{const s=e.getBoundingClientRect().height;return{delay:t,duration:n,easing:a,css:(e,t)=>`box-sizing: border-boxoverflow: hidden;opacity: ${e};height: ${e*s}px;`}},e=>({destroy:be(e,"scroll",(()=>{n(5,m=0!==e.scrollTop)}),{passive:!0})}),s,function(e){c=e,n(0,c)},function(e){f=e,n(4,f)},function(e,t,a,s){a[s]=e,n(0,c)},function(e){f=e,n(4,f)}]}class ut extends t{constructor(e){super(),n(this,e,it,rt,a,{query:2,results:0,nextCursor:1,total:3})}}export{ut as default,ct as load};
