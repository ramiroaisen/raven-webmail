import{bk as e,S as t,i as n,s as a,e as s,j as l,c as r,a as o,m as c,d as i,b as u,f,o as m,x as $,u as d,v as h,k as g,t as v,n as p,g as b,G as x,H as w,I as y,U as j,V as E,J as D,r as k,w as I,h as V,a3 as _,N as M,aL as q,b5 as C,b6 as P,b7 as T,b8 as R,bl as S,E as N,O as L,b9 as A,l as U,aw as H,ba as z,W as B,bb as F,K as G,ac as J,aY as K,D as O,bc as Q,bd as W,Q as Y,b4 as X,y as Z,F as ee,P as te,bf as ne,L as ae,a0 as se,ad as le,bm as re,a1 as oe,$ as ce}from"../chunks/vendor-c6674e75.js";import{m as ie,t as ue,b as fe,d as me,f as $e,e as de,_ as he,n as ge,l as ve,g as pe}from"../chunks/util-75f4ce1f.js";import{t as be,a as xe}from"../chunks/MenuItem-f687bcf2.js";import{R as we}from"../chunks/Ripple-ada69b16.js";import{a as ye,C as je}from"../chunks/compose-68bd1bff.js";import{T as Ee}from"../chunks/TabTop-1c2ebbed.js";import{l as De}from"../chunks/locale-43eac5b3.js";import"../chunks/singletons-12a22614.js";import"../chunks/signature-38791045.js";import"../chunks/preload-helper-ec9aa979.js";function ke(e){let t,n;return t=new C({}),{c(){l(t.$$.fragment)},l(e){c(t.$$.fragment,e)},m(e,a){m(t,e,a),n=!0},i(e){n||($(t.$$.fragment,e),n=!0)},o(e){d(t.$$.fragment,e),n=!1},d(e){h(t,e)}}}function Ie(e){let t,n;return t=new P({}),{c(){l(t.$$.fragment)},l(e){c(t.$$.fragment,e)},m(e,a){m(t,e,a),n=!0},i(e){n||($(t.$$.fragment,e),n=!0)},o(e){d(t.$$.fragment,e),n=!1},d(e){h(t,e)}}}function Ve(e){let t,n;return t=new T({}),{c(){l(t.$$.fragment)},l(e){c(t.$$.fragment,e)},m(e,a){m(t,e,a),n=!0},i(e){n||($(t.$$.fragment,e),n=!0)},o(e){d(t.$$.fragment,e),n=!1},d(e){h(t,e)}}}function _e(e){let t,n;return t=new R({}),{c(){l(t.$$.fragment)},l(e){c(t.$$.fragment,e)},m(e,a){m(t,e,a),n=!0},i(e){n||($(t.$$.fragment,e),n=!0)},o(e){d(t.$$.fragment,e),n=!1},d(e){h(t,e)}}}function Me(e){let t,n,a;return n=new q({}),{c(){t=s("div"),l(n.$$.fragment),this.h()},l(e){t=r(e,"DIV",{class:!0});var a=o(t);c(n.$$.fragment,a),a.forEach(i),this.h()},h(){u(t,"class","attachments svelte-2a05jv")},m(e,s){f(e,t,s),m(n,t,null),a=!0},i(e){a||($(n.$$.fragment,e),a=!0)},o(e){d(n.$$.fragment,e),a=!1},d(e){e&&i(t),h(n)}}}function qe(e){let t,n,a,q,C,P,T,R,S,N,L,A,U,H,z,B,F,G,J,K,O,Q,W,Y,X,Z,ee,te,ne,ae,se,le,re,oe,ce,fe,me,$e,de,he,ge=Ce(e[2],e[0])+"",ve=ie(e[2])+"",pe=(e[0].subject||"")+"",be=(e[0].intro||"")+"",xe=ue(e[0].date)+"";const ye=[Ie,ke],je=[];function Ee(e,t){return e[3]?0:1}a=Ee(e),q=je[a]=ye[a](e),P=new we({});const De=[_e,Ve],qe=[];function Pe(e,t){return e[0].flagged?0:1}S=Pe(e),N=qe[S]=De[S](e),A=new we({});let Te=e[0].attachments&&Me();return{c(){t=s("a"),n=s("div"),q.c(),C=g(),l(P.$$.fragment),T=g(),R=s("div"),N.c(),L=g(),l(A.$$.fragment),U=g(),H=s("div"),z=s("div"),B=v(ge),G=g(),J=s("div"),K=s("div"),O=s("div"),Q=v(ve),W=g(),Y=s("div"),X=s("span"),Z=v(pe),te=g(),ne=s("span"),ae=v(be),le=g(),re=s("div"),oe=s("div"),ce=v(xe),fe=g(),Te&&Te.c(),this.h()},l(e){t=r(e,"A",{href:!0,class:!0});var a=o(t);n=r(a,"DIV",{class:!0});var s=o(n);q.l(s),C=p(s),c(P.$$.fragment,s),s.forEach(i),T=p(a),R=r(a,"DIV",{class:!0});var l=o(R);N.l(l),L=p(l),c(A.$$.fragment,l),l.forEach(i),U=p(a),H=r(a,"DIV",{class:!0});var u=o(H);z=r(u,"DIV",{class:!0});var f=o(z);B=b(f,ge),f.forEach(i),G=p(u),J=r(u,"DIV",{class:!0});var m=o(J);K=r(m,"DIV",{class:!0});var $=o(K);O=r($,"DIV",{class:!0});var d=o(O);Q=b(d,ve),d.forEach(i),W=p($),Y=r($,"DIV",{class:!0});var h=o(Y);X=r(h,"SPAN",{class:!0});var g=o(X);Z=b(g,pe),g.forEach(i),te=p(h),ne=r(h,"SPAN",{class:!0});var v=o(ne);ae=b(v,be),v.forEach(i),h.forEach(i),$.forEach(i),le=p(m),re=r(m,"DIV",{class:!0});var x=o(re);oe=r(x,"DIV",{class:!0});var w=o(oe);ce=b(w,xe),w.forEach(i),fe=p(x),Te&&Te.l(x),x.forEach(i),m.forEach(i),u.forEach(i),a.forEach(i),this.h()},h(){u(n,"class","select cell-icon btn-dark svelte-2a05jv"),u(R,"class","cell-icon btn-dark flag svelte-2a05jv"),u(z,"class","from svelte-2a05jv"),u(O,"class","mailbox svelte-2a05jv"),u(X,"class","subject svelte-2a05jv"),u(ne,"class","intro svelte-2a05jv"),u(Y,"class","subject-intro svelte-2a05jv"),u(K,"class","mailbox-subject-intro svelte-2a05jv"),u(oe,"class","date svelte-2a05jv"),u(re,"class","date-attachments svelte-2a05jv"),u(J,"class","end svelte-2a05jv"),u(H,"class","flex svelte-2a05jv"),u(t,"href",me="/mailbox/"+e[2].id+"/message/"+e[0].id),u(t,"class","na message svelte-2a05jv"),x(t,"seen",e[0].seen),x(t,"selected",e[3]),x(t,"flagged",e[0].flagged)},m(s,l){f(s,t,l),w(t,n),je[a].m(n,null),w(n,C),m(P,n,null),w(t,T),w(t,R),qe[S].m(R,null),w(R,L),m(A,R,null),w(t,U),w(t,H),w(H,z),w(z,B),w(H,G),w(H,J),w(J,K),w(K,O),w(O,Q),w(K,W),w(K,Y),w(Y,X),w(X,Z),w(Y,te),w(Y,ne),w(ne,ae),w(J,le),w(J,re),w(re,oe),w(oe,ce),w(re,fe),Te&&Te.m(re,null),$e=!0,de||(he=[y(n,"click",j(E(e[4]))),y(R,"click",j(E(e[5]))),D(F=e[7].call(null,z,e[1])),D(ee=e[7].call(null,X,e[1])),D(se=e[7].call(null,ne,e[1])),y(t,"click",e[6])],de=!0)},p(e,[s]){let l=a;a=Ee(e),a!==l&&(k(),d(je[l],1,1,(()=>{je[l]=null})),I(),q=je[a],q||(q=je[a]=ye[a](e),q.c()),$(q,1),q.m(n,C));let r=S;S=Pe(e),S!==r&&(k(),d(qe[r],1,1,(()=>{qe[r]=null})),I(),N=qe[S],N||(N=qe[S]=De[S](e),N.c()),$(N,1),N.m(R,L)),(!$e||5&s)&&ge!==(ge=Ce(e[2],e[0])+"")&&V(B,ge),F&&_(F.update)&&2&s&&F.update.call(null,e[1]),(!$e||4&s)&&ve!==(ve=ie(e[2])+"")&&V(Q,ve),(!$e||1&s)&&pe!==(pe=(e[0].subject||"")+"")&&V(Z,pe),ee&&_(ee.update)&&2&s&&ee.update.call(null,e[1]),(!$e||1&s)&&be!==(be=(e[0].intro||"")+"")&&V(ae,be),se&&_(se.update)&&2&s&&se.update.call(null,e[1]),(!$e||1&s)&&xe!==(xe=ue(e[0].date)+"")&&V(ce,xe),e[0].attachments?Te?1&s&&$(Te,1):(Te=Me(),Te.c(),$(Te,1),Te.m(re,null)):Te&&(k(),d(Te,1,1,(()=>{Te=null})),I()),(!$e||5&s&&me!==(me="/mailbox/"+e[2].id+"/message/"+e[0].id))&&u(t,"href",me),1&s&&x(t,"seen",e[0].seen),8&s&&x(t,"selected",e[3]),1&s&&x(t,"flagged",e[0].flagged)},i(e){$e||($(q),$(P.$$.fragment,e),$(N),$(A.$$.fragment,e),$(Te),$e=!0)},o(e){d(q),d(P.$$.fragment,e),d(N),d(A.$$.fragment,e),d(Te),$e=!1},d(e){e&&i(t),je[a].d(),h(P),qe[S].d(),h(A),Te&&Te.d(),de=!1,M(he)}}}const Ce=(e,t)=>{var n,a;return"\\Drafts"===e.specialUse||"\\Sent"===e.specialUse?`To: ${(null===(n=t.to[0])||void 0===n?void 0:n.name)||(null===(a=t.to[0])||void 0===a?void 0:a.address)||""}`:t.from.name||t.from.address||""},Pe=e.exports.toString();function Te(e,t,n){let a;var s=this&&this.__awaiter||function(e,t,n,a){return new(n||(n=Promise))((function(s,l){function r(e){try{c(a.next(e))}catch(t){l(t)}}function o(e){try{c(a.throw(e))}catch(t){l(t)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,o)}c((a=a.apply(e,t||[])).next())}))};let{query:l}=t,{mailbox:r}=t,{message:o}=t,{selection:c=[]}=t;const i=fe((()=>s(void 0,void 0,void 0,(function*(){n(0,o.flagged=!o.flagged,o),yield me(`/api/mailboxes/${r.id}/messages/${o.id}/flag`,{value:o.flagged}).catch((e=>{throw n(0,o.flagged=!o.flagged,o),e}))})))),u=fe((e=>s(void 0,void 0,void 0,(function*(){$e(r)&&(e.preventDefault(),e.stopPropagation(),yield ye(r,o.id))}))));return e.$$set=e=>{"query"in e&&n(1,l=e.query),"mailbox"in e&&n(2,r=e.mailbox),"message"in e&&n(0,o=e.message),"selection"in e&&n(8,c=e.selection)},e.$$.update=()=>{257&e.$$.dirty&&n(3,a=c.some((e=>e.mailbox===o.mailbox&&e.id===o.id)))},[o,l,r,a,()=>{const e=c.filter((e=>e.id!==o.id));n(8,c=a?e:[...e,o])},i,u,(e,t)=>{const n=e.textContent,a=t=>{const a=t.split(/\s+/g);if(0===a.length)return void(e.textContent=n);const s=new RegExp(a.map((e=>Pe(S(e)))).join("|"),"ig"),l=n.replace(s,(e=>{const t=document.createElement("span");return t.textContent=e,t.classList.add("highlight"),t.outerHTML}));e.innerHTML=l};return a(t),{update:a}},c]}class Re extends t{constructor(e){super(),n(this,e,Te,qe,a,{query:1,mailbox:2,message:0,selection:8})}}function Se(e){let t,n;return t=new z({}),{c(){l(t.$$.fragment)},l(e){c(t.$$.fragment,e)},m(e,a){m(t,e,a),n=!0},i(e){n||($(t.$$.fragment,e),n=!0)},o(e){d(t.$$.fragment,e),n=!1},d(e){h(t,e)}}}function Ne(e){let t,n;return t=new P({}),{c(){l(t.$$.fragment)},l(e){c(t.$$.fragment,e)},m(e,a){m(t,e,a),n=!0},i(e){n||($(t.$$.fragment,e),n=!0)},o(e){d(t.$$.fragment,e),n=!1},d(e){h(t,e)}}}function Le(e){let t,n;return t=new C({}),{c(){l(t.$$.fragment)},l(e){c(t.$$.fragment,e)},m(e,a){m(t,e,a),n=!0},i(e){n||($(t.$$.fragment,e),n=!0)},o(e){d(t.$$.fragment,e),n=!1},d(e){h(t,e)}}}function Ae(e){let t,n,a,x,j,E,q,C,P,T,R,S,N,L,A,U,H,z,O,Q,W,Y,X=e[1].length+"";const Z=[ze,He],ee=[];function te(e,t){return(null==a||2&t)&&(a=!e[1].every(Qe)),a?0:1}function ne(e,t){return 1===e[1].length?Fe:Be}x=te(e,-1),j=ee[x]=Z[x](e),C=new B({}),T=new we({}),L=new F({});let ae=ne(e),se=ae(e);return{c(){t=s("div"),n=s("div"),j.c(),E=g(),q=s("div"),l(C.$$.fragment),P=g(),l(T.$$.fragment),S=g(),N=s("div"),l(L.$$.fragment),A=g(),U=s("span"),H=v(X),z=g(),se.c(),this.h()},l(e){t=r(e,"DIV",{class:!0});var a=o(t);n=r(a,"DIV",{class:!0});var s=o(n);j.l(s),E=p(s),q=r(s,"DIV",{class:!0});var l=o(q);c(C.$$.fragment,l),P=p(l),c(T.$$.fragment,l),l.forEach(i),s.forEach(i),S=p(a),N=r(a,"DIV",{class:!0});var u=o(N);c(L.$$.fragment,u),A=p(u),U=r(u,"SPAN",{class:!0});var f=o(U);H=b(f,X),z=p(f),se.l(f),f.forEach(i),u.forEach(i),a.forEach(i),this.h()},h(){u(q,"class","action btn-dark"),u(n,"class","action-group"),u(U,"class","svelte-ejn2om"),u(N,"class","selection-info svelte-ejn2om"),u(t,"class","only-when-selection svelte-ejn2om")},m(a,s){f(a,t,s),w(t,n),ee[x].m(n,null),w(n,E),w(n,q),m(C,q,null),w(q,P),m(T,q,null),w(t,S),w(t,N),m(L,N,null),w(N,A),w(N,U),w(U,H),w(U,z),se.m(U,null),Q=!0,W||(Y=[D(R=be.call(null,q,e[5].Delete)),y(q,"click",e[9])],W=!0)},p(e,t){let a=x;x=te(e,t),x===a?ee[x].p(e,t):(k(),d(ee[a],1,1,(()=>{ee[a]=null})),I(),j=ee[x],j?j.p(e,t):(j=ee[x]=Z[x](e),j.c()),$(j,1),j.m(n,E)),R&&_(R.update)&&32&t&&R.update.call(null,e[5].Delete),(!Q||2&t)&&X!==(X=e[1].length+"")&&V(H,X),ae===(ae=ne(e))&&se?se.p(e,t):(se.d(1),se=ae(e),se&&(se.c(),se.m(U,null)))},i(e){Q||($(j),$(C.$$.fragment,e),$(T.$$.fragment,e),$(L.$$.fragment,e),e&&(O||G((()=>{O=J(t,K,{duration:200}),O.start()}))),Q=!0)},o(e){d(j),d(C.$$.fragment,e),d(T.$$.fragment,e),d(L.$$.fragment,e),Q=!1},d(e){e&&i(t),ee[x].d(),h(C),h(T),h(L),se.d(),W=!1,M(Y)}}}function Ue(e){let t;function n(e,t){return 1===e[2]?Je:Ge}let a=n(e),l=a(e);return{c(){t=s("div"),l.c(),this.h()},l(e){t=r(e,"DIV",{class:!0});var n=o(t);l.l(n),n.forEach(i),this.h()},h(){u(t,"class","count svelte-ejn2om")},m(e,n){f(e,t,n),l.m(t,null)},p(e,s){a===(a=n(e))&&l?l.p(e,s):(l.d(1),l=a(e),l&&(l.c(),l.m(t,null)))},i:O,o:O,d(e){e&&i(t),l.d()}}}function He(e){let t,n,a,v,b,x,j,E;return n=new Q({}),v=new we({}),{c(){t=s("div"),l(n.$$.fragment),a=g(),l(v.$$.fragment),this.h()},l(e){t=r(e,"DIV",{class:!0});var s=o(t);c(n.$$.fragment,s),a=p(s),c(v.$$.fragment,s),s.forEach(i),this.h()},h(){u(t,"class","action btn-dark")},m(s,l){f(s,t,l),m(n,t,null),w(t,a),m(v,t,null),x=!0,j||(E=[D(b=be.call(null,t,e[5].Mark_as_not_seen)),y(t,"click",e[13])],j=!0)},p(e,t){b&&_(b.update)&&32&t&&b.update.call(null,e[5].Mark_as_not_seen)},i(e){x||($(n.$$.fragment,e),$(v.$$.fragment,e),x=!0)},o(e){d(n.$$.fragment,e),d(v.$$.fragment,e),x=!1},d(e){e&&i(t),h(n),h(v),j=!1,M(E)}}}function ze(e){let t,n,a,v,b,x,j,E;return n=new W({}),v=new we({}),{c(){t=s("div"),l(n.$$.fragment),a=g(),l(v.$$.fragment),this.h()},l(e){t=r(e,"DIV",{class:!0});var s=o(t);c(n.$$.fragment,s),a=p(s),c(v.$$.fragment,s),s.forEach(i),this.h()},h(){u(t,"class","action btn-dark")},m(s,l){f(s,t,l),m(n,t,null),w(t,a),m(v,t,null),x=!0,j||(E=[D(b=be.call(null,t,e[5].Mark_as_seen)),y(t,"click",e[12])],j=!0)},p(e,t){b&&_(b.update)&&32&t&&b.update.call(null,e[5].Mark_as_seen)},i(e){x||($(n.$$.fragment,e),$(v.$$.fragment,e),x=!0)},o(e){d(n.$$.fragment,e),d(v.$$.fragment,e),x=!1},d(e){e&&i(t),h(n),h(v),j=!1,M(E)}}}function Be(e){let t,n=e[5].messages+"";return{c(){t=v(n)},l(e){t=b(e,n)},m(e,n){f(e,t,n)},p(e,a){32&a&&n!==(n=e[5].messages+"")&&V(t,n)},d(e){e&&i(t)}}}function Fe(e){let t,n=e[5].message+"";return{c(){t=v(n)},l(e){t=b(e,n)},m(e,n){f(e,t,n)},p(e,a){32&a&&n!==(n=e[5].message+"")&&V(t,n)},d(e){e&&i(t)}}}function Ge(e){let t,n,a,s=e[5].messages+"";return{c(){t=v(e[2]),n=g(),a=v(s)},l(l){t=b(l,e[2]),n=p(l),a=b(l,s)},m(e,s){f(e,t,s),f(e,n,s),f(e,a,s)},p(e,n){4&n&&V(t,e[2]),32&n&&s!==(s=e[5].messages+"")&&V(a,s)},d(e){e&&i(t),e&&i(n),e&&i(a)}}}function Je(e){let t,n,a=e[5].message+"";return{c(){t=v("1 "),n=v(a)},l(e){t=b(e,"1 "),n=b(e,a)},m(e,a){f(e,t,a),f(e,n,a)},p(e,t){32&t&&a!==(a=e[5].message+"")&&V(n,a)},d(e){e&&i(t),e&&i(n)}}}function Ke(e){let t,n,a,v,b,x,j,E,V,q,C,P,T,R,S,N,L,z,B,F;const G=[Le,Ne,Se],J=[];function K(e,t){return 0===e[1].length?0:e[1].length===e[0].length?1:2}a=K(e),v=J[a]=G[a](e),x=new we({}),q=new A({}),P=new we({});const O=[Ue,Ae],Q=[];function W(e,t){return 0===e[1].length&&0!==e[2]?0:0!==e[1].length?1:-1}return~(S=W(e))&&(N=Q[S]=O[S](e)),{c(){t=s("div"),n=s("div"),v.c(),b=g(),l(x.$$.fragment),j=g(),E=s("div"),V=s("div"),l(q.$$.fragment),C=g(),l(P.$$.fragment),R=g(),N&&N.c(),L=U(),this.h()},l(e){t=r(e,"DIV",{class:!0});var a=o(t);n=r(a,"DIV",{class:!0});var s=o(n);v.l(s),b=p(s),c(x.$$.fragment,s),s.forEach(i),j=p(a),E=r(a,"DIV",{class:!0});var l=o(E);V=r(l,"DIV",{class:!0,style:!0});var u=o(V);c(q.$$.fragment,u),u.forEach(i),C=p(l),c(P.$$.fragment,l),l.forEach(i),a.forEach(i),R=p(e),N&&N.l(e),L=U(),this.h()},h(){u(n,"class","action btn-dark"),u(V,"class","reload-inner svelte-ejn2om"),H(V,"transform","rotate("+360*e[4]+"deg)"),u(E,"class","action btn-dark reload"),u(t,"class","action-group select svelte-ejn2om")},m(s,l){f(s,t,l),w(t,n),J[a].m(n,null),w(n,b),m(x,n,null),w(t,j),w(t,E),w(E,V),m(q,V,null),w(E,C),m(P,E,null),f(s,R,l),~S&&Q[S].m(s,l),f(s,L,l),z=!0,B||(F=[y(n,"click",e[10]),D(T=be.call(null,E,e[5].Reload)),y(E,"click",e[7])],B=!0)},p(e,t){let s=a;a=K(e),a!==s&&(k(),d(J[s],1,1,(()=>{J[s]=null})),I(),v=J[a],v||(v=J[a]=G[a](e),v.c()),$(v,1),v.m(n,b)),(!z||16&t)&&H(V,"transform","rotate("+360*e[4]+"deg)"),T&&_(T.update)&&32&t&&T.update.call(null,e[5].Reload);let l=S;S=W(e),S===l?~S&&Q[S].p(e,t):(N&&(k(),d(Q[l],1,1,(()=>{Q[l]=null})),I()),~S?(N=Q[S],N?N.p(e,t):(N=Q[S]=O[S](e),N.c()),$(N,1),N.m(L.parentNode,L)):N=null)},i(e){z||($(v),$(x.$$.fragment,e),$(q.$$.fragment,e),$(P.$$.fragment,e),$(N),z=!0)},o(e){d(v),d(x.$$.fragment,e),d(q.$$.fragment,e),d(P.$$.fragment,e),d(N),z=!1},d(e){e&&i(t),J[a].d(),h(x),h(q),h(P),e&&i(R),~S&&Q[S].d(e),e&&i(L),B=!1,M(F)}}}function Oe(e){let t,n;return t=new Ee({props:{scrolled:e[3],$$slots:{default:[Ke]},$$scope:{ctx:e}}}),{c(){l(t.$$.fragment)},l(e){c(t.$$.fragment,e)},m(e,a){m(t,e,a),n=!0},p(e,[n]){const a={};8&n&&(a.scrolled=e[3]),1048631&n&&(a.$$scope={dirty:n,ctx:e}),t.$set(a)},i(e){n||($(t.$$.fragment,e),n=!0)},o(e){d(t.$$.fragment,e),n=!1},d(e){h(t,e)}}}const Qe=e=>e.seen;function We(e,t,n){let a,s;N(e,De,(e=>n(5,s=e)));var l=this&&this.__awaiter||function(e,t,n,a){return new(n||(n=Promise))((function(s,l){function r(e){try{c(a.next(e))}catch(t){l(t)}}function o(e){try{c(a.throw(e))}catch(t){l(t)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,o)}c((a=a.apply(e,t||[])).next())}))};let{results:r}=t,{selection:o}=t,{total:c}=t,{scrolled:i=!1}=t,{mailboxMap:u}=t;const{prev:f,next:m}=L("search"),{mailboxes:$}=L("dash");N(e,$,(e=>n(14,a=e)));let d=0;const h=fe((e=>l(void 0,void 0,void 0,(function*(){if(0===o.length)return;const t=new Map;for(const e of o){const n=t.get(e.mailbox);null==n?t.set(e.mailbox,[e.id]):n.push(e.id)}const a=[];for(const[n,s]of t.entries())a.push(me(`/api/mailboxes/${n}/messages`,{message:s.join(","),seen:e}));yield Promise.all(a);for(const n of o)n.seen=e;n(0,r=[...r]),n(1,o=[...o])})))),g=fe((()=>l(void 0,void 0,void 0,(function*(){if(0===o.length)return;const e=a.find(de),t=[],n=new Map;for(const a of o){const e=u.get(a.mailbox);if(de(e)||$e(e))console.log("delete"),t.push(he(`/api/mailboxes/${a.mailbox}/messages/${a.id}`));else{console.log("move");const e=n.get(a.mailbox);e?e.push(a.id):n.set(a.mailbox,[a.id])}}for(const[a,s]of n.entries())t.push(me(`/api/mailboxes/${a}/messages`,{message:s.join(","),moveTo:e.id}));yield Promise.all(t),v()})))),v=()=>{const e=o.map((e=>`${e.mailbox}-${e.id}`));n(0,r=r.filter((t=>!e.includes(`${t.mailbox}-${t.id}`)))),r.length<25&&setTimeout(m,10),n(1,o=[])};return e.$$set=e=>{"results"in e&&n(0,r=e.results),"selection"in e&&n(1,o=e.selection),"total"in e&&n(2,c=e.total),"scrolled"in e&&n(3,i=e.scrolled),"mailboxMap"in e&&n(11,u=e.mailboxMap)},[r,o,c,i,d,s,$,()=>{n(4,d++,d),f()},h,g,()=>{o.length===r.length?n(1,o=[]):n(1,o=r.slice())},u,()=>h(!0),()=>h(!1)]}class Ye extends t{constructor(e){super(),n(this,e,We,Oe,a,{results:0,selection:1,total:2,scrolled:3,mailboxMap:11})}}const{Map:Xe}=re;function Ze(e,t,n){const a=e.slice();return a[23]=t[n],a[24]=t,a[25]=n,a}function et(e){let t,n,a,l,c=e[8].There_are_no_search_results_for_this_query+"";return{c(){t=s("div"),n=s("div"),a=v(c),this.h()},l(e){t=r(e,"DIV",{class:!0});var s=o(t);n=r(s,"DIV",{class:!0});var l=o(n);a=b(l,c),l.forEach(i),s.forEach(i),this.h()},h(){u(n,"class","empty svelte-1j01euu"),u(t,"class","empty-wrap")},m(e,s){f(e,t,s),w(t,n),w(n,a)},p(e,t){256&t&&c!==(c=e[8].There_are_no_search_results_for_this_query+"")&&V(a,c)},i(n){n&&(l||G((()=>{l=J(t,e[11],{duration:250}),l.start()})))},o:O,d(e){e&&i(t)}}}function tt(e){let t,n,a,l,c,m,h,v=[],b=new Xe,x=e[0];const w=e=>`${e[23].mailbox}-${e[23].id}`;for(let s=0;s<x.length;s+=1){let t=Ze(e,x,s),n=w(t);b.set(n,v[s]=nt(n,t))}const y=[st,at],j=[];function E(e,t){return e[6]?0:e[1]?1:-1}return~(c=E(e))&&(m=j[c]=y[c](e)),{c(){t=s("div");for(let e=0;e<v.length;e+=1)v[e].c();a=g(),l=s("div"),m&&m.c(),this.h()},l(e){t=r(e,"DIV",{class:!0});var n=o(t);for(let t=0;t<v.length;t+=1)v[t].l(n);n.forEach(i),a=p(e),l=r(e,"DIV",{class:!0});var s=o(l);m&&m.l(s),s.forEach(i),this.h()},h(){u(t,"class","messages"),u(l,"class","next-wrap svelte-1j01euu")},m(e,n){f(e,t,n);for(let a=0;a<v.length;a+=1)v[a].m(t,null);f(e,a,n),f(e,l,n),~c&&j[c].m(l,null),h=!0},p(e,n){149&n&&(x=e[0],k(),v=se(v,n,w,1,e,x,b,t,oe,nt,null,Ze),I());let a=c;c=E(e),c===a?~c&&j[c].p(e,n):(m&&(k(),d(j[a],1,1,(()=>{j[a]=null})),I()),~c?(m=j[c],m?m.p(e,n):(m=j[c]=y[c](e),m.c()),$(m,1),m.m(l,null)):m=null)},i(a){if(!h){for(let e=0;e<x.length;e+=1)$(v[e]);a&&G((()=>{n||(n=ae(t,e[11],{duration:250},!0)),n.run(1)})),$(m),h=!0}},o(a){for(let e=0;e<v.length;e+=1)d(v[e]);a&&(n||(n=ae(t,e[11],{duration:250},!1)),n.run(0)),d(m),h=!1},d(e){e&&i(t);for(let t=0;t<v.length;t+=1)v[t].d();e&&n&&n.end(),e&&i(a),e&&i(l),~c&&j[c].d()}}}function nt(e,t){let n,a,v,b,x,y,j;function E(e){t[16](e,t[23],t[24],t[25])}function D(e){t[17](e)}let k={mailbox:t[7].get(t[23].mailbox),query:t[2]};return void 0!==t[23]&&(k.message=t[23]),void 0!==t[4]&&(k.selection=t[4]),a=new Re({props:k}),ee.push((()=>te(a,"message",E))),ee.push((()=>te(a,"selection",D))),{key:e,first:null,c(){n=s("div"),l(a.$$.fragment),x=g(),this.h()},l(e){n=r(e,"DIV",{class:!0});var t=o(n);c(a.$$.fragment,t),x=p(t),t.forEach(i),this.h()},h(){u(n,"class","message"),this.first=n},m(e,t){f(e,n,t),m(a,n,null),w(n,x),j=!0},p(e,n){t=e;const s={};129&n&&(s.mailbox=t[7].get(t[23].mailbox)),4&n&&(s.query=t[2]),!v&&1&n&&(v=!0,s.message=t[23],Y((()=>v=!1))),!b&&16&n&&(b=!0,s.selection=t[4],Y((()=>b=!1))),a.$set(s)},i(e){j||($(a.$$.fragment,e),e&&G((()=>{y||(y=ae(n,t[11],{duration:250},!0)),y.run(1)})),j=!0)},o(e){d(a.$$.fragment,e),e&&(y||(y=ae(n,t[11],{duration:250},!1)),y.run(0)),j=!1},d(e){e&&i(n),h(a),e&&y&&y.end()}}}function at(e){let t,n,a,v,b,x,j;return n=new ce({}),v=new we({}),{c(){t=s("div"),l(n.$$.fragment),a=g(),l(v.$$.fragment),this.h()},l(e){t=r(e,"DIV",{class:!0});var s=o(t);c(n.$$.fragment,s),a=p(s),c(v.$$.fragment,s),s.forEach(i),this.h()},h(){u(t,"class","next btn-dark svelte-1j01euu")},m(s,l){f(s,t,l),m(n,t,null),w(t,a),m(v,t,null),b=!0,x||(j=y(t,"click",e[10]),x=!0)},p:O,i(e){b||($(n.$$.fragment,e),$(v.$$.fragment,e),b=!0)},o(e){d(n.$$.fragment,e),d(v.$$.fragment,e),b=!1},d(e){e&&i(t),h(n),h(v),x=!1,j()}}}function st(e){let t,n,a;return n=new je({}),{c(){t=s("div"),l(n.$$.fragment),this.h()},l(e){t=r(e,"DIV",{class:!0});var a=o(t);c(n.$$.fragment,a),a.forEach(i),this.h()},h(){u(t,"class","loading-more svelte-1j01euu")},m(e,s){f(e,t,s),m(n,t,null),a=!0},p:O,i(e){a||($(n.$$.fragment,e),a=!0)},o(e){d(n.$$.fragment,e),a=!1},d(e){e&&i(t),h(n)}}}function lt(e){let t,n,a,v,b,x,y,j,E,V,_,M;function q(t){e[14](t)}function C(t){e[15](t)}let P={scrolled:e[5],total:e[3],mailboxMap:e[7]};void 0!==e[0]&&(P.results=e[0]),void 0!==e[4]&&(P.selection=e[4]),n=new Ye({props:P}),ee.push((()=>te(n,"results",q))),ee.push((()=>te(n,"selection",C)));const T=[tt,et],R=[];function S(e,t){return e[0].length||e[6]?0:1}return y=S(e),j=R[y]=T[y](e),{c(){t=s("div"),l(n.$$.fragment),b=g(),x=s("div"),j.c(),this.h()},l(e){t=r(e,"DIV",{class:!0});var a=o(t);c(n.$$.fragment,a),b=p(a),x=r(a,"DIV",{class:!0});var s=o(x);j.l(s),s.forEach(i),a.forEach(i),this.h()},h(){u(x,"class","content svelte-1j01euu"),u(t,"class","search svelte-1j01euu")},m(a,s){f(a,t,s),m(n,t,null),w(t,b),w(t,x),R[y].m(x,null),V=!0,_||(M=D(e[12].call(null,x)),_=!0)},p(e,t){const s={};32&t&&(s.scrolled=e[5]),8&t&&(s.total=e[3]),128&t&&(s.mailboxMap=e[7]),!a&&1&t&&(a=!0,s.results=e[0],Y((()=>a=!1))),!v&&16&t&&(v=!0,s.selection=e[4],Y((()=>v=!1))),n.$set(s);let l=y;y=S(e),y===l?R[y].p(e,t):(k(),d(R[l],1,1,(()=>{R[l]=null})),I(),j=R[y],j?j.p(e,t):(j=R[y]=T[y](e),j.c()),$(j,1),j.m(x,null))},i(e){V||($(n.$$.fragment,e),$(j),E||G((()=>{E=J(x,le,{duration:150,y:-15}),E.start()})),V=!0)},o(e){d(n.$$.fragment,e),d(j),V=!1},d(e){e&&i(t),h(n),R[y].d(),_=!1,M()}}}function rt(e){let t,n,s,l,r=e[2];document.title=t=e[2];let o=lt(e);return{c(){n=g(),o.c(),s=U()},l(e){X('[data-svelte="svelte-1cx3okz"]',document.head).forEach(i),n=p(e),o.l(e),s=U()},m(e,t){f(e,n,t),o.m(e,t),f(e,s,t),l=!0},p(e,[n]){(!l||4&n)&&t!==(t=e[2])&&(document.title=t),4&n&&a(r,r=e[2])?(k(),d(o,1,1,O),I(),o=lt(e),o.c(),$(o),o.m(s.parentNode,s)):o.p(e,n)},i(e){l||($(o),l=!0)},o(e){d(o),l=!1},d(e){e&&i(n),e&&i(s),o.d(e)}}}var ot=function(e,t,n,a){return new(n||(n=Promise))((function(s,l){function r(e){try{c(a.next(e))}catch(t){l(t)}}function o(e){try{c(a.throw(e))}catch(t){l(t)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,o)}c((a=a.apply(e,t||[])).next())}))};const ct=({page:e,fetch:t,session:n})=>ot(void 0,void 0,void 0,(function*(){return yield ge({page:e,fetch:t,session:n})}));function it(e,t,n){let a,s,l;N(e,De,(e=>n(8,l=e)));var r=this&&this.__awaiter||function(e,t,n,a){return new(n||(n=Promise))((function(s,l){function r(e){try{c(a.next(e))}catch(t){l(t)}}function o(e){try{c(a.throw(e))}catch(t){l(t)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,o)}c((a=a.apply(e,t||[])).next())}))};let{query:o}=t,{results:c}=t,{nextCursor:i}=t,{total:u}=t,f=[],m=!1;const{mailboxes:$}=L("dash");N(e,$,(e=>n(13,s=e)));let d=!1;const h=fe((()=>r(void 0,void 0,void 0,(function*(){if(i){n(6,d=!0);try{const e=yield ve(`/api/search?next=${i}&limit=50`);n(0,c=(e=>{const t=[];for(const n of e)t.some((e=>e.mailbox===n.mailbox&&e.id===n.id))||t.push(n);return t})([...c,...e.results])),n(1,i=e.nextCursor),n(6,d=!1)}catch(e){throw n(6,d=!1),e}}})))),g=fe((()=>r(void 0,void 0,void 0,(function*(){yield pe(`/search?query=${encodeURIComponent(o)}&now=${Date.now()}`,{replaceState:!0,keepfocus:!0})}))));Z("search",{next:h,prev:g});return e.$$set=e=>{"query"in e&&n(2,o=e.query),"results"in e&&n(0,c=e.results),"nextCursor"in e&&n(1,i=e.nextCursor),"total"in e&&n(3,u=e.total)},e.$$.update=()=>{8192&e.$$.dirty&&n(7,a=(e=>{const t=new Map;for(const n of e)t.set(n.id,n);return t})(s))},[c,i,o,u,f,m,d,a,l,$,h,(e,{delay:t=0,duration:n=400,easing:a=ne}={})=>{const s=e.getBoundingClientRect().height;return{delay:t,duration:n,easing:a,css:(e,t)=>`box-sizing: border-boxoverflow: hidden;opacity: ${e};height: ${e*s}px;`}},e=>({destroy:xe(e,"scroll",(()=>{n(5,m=0!==e.scrollTop)}),{passive:!0})}),s,function(e){c=e,n(0,c)},function(e){f=e,n(4,f)},function(e,t,a,s){a[s]=e,n(0,c)},function(e){f=e,n(4,f)}]}class ut extends t{constructor(e){super(),n(this,e,it,rt,a,{query:2,results:0,nextCursor:1,total:3})}}export{ut as default,ct as load};
